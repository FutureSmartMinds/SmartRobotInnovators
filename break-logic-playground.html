<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GlowBit Logic Playground â€” If, Then, Else (and Comparisons!)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Cache-Control" content="no-store" />

  <!-- Core libs (cache-busted) -->
  <script src="lib/blockly_compressed.js?v=lp3"></script>
  <script src="lib/blocks_compressed.js?v=lp3"></script>
  <script src="lib/javascript_compressed.js?v=lp3"></script>
  <script src="lib/msg/en.js?v=lp3"></script>
  <script src="assets/global.js?v=lp3"></script>
  <script src="lib/blockly_xml_patch.js?v=lp3"></script>

  <style>
    /* Page wrapper: center like your projects */
    .gb-wrapper {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 12px;
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
    }

    /* Header (cloud look) â€” centered title + subtitle */
    .gb-header { text-align: center; font-weight: 800; margin: 10px 0; box-shadow: 0 1px 4px rgba(0,0,0,0.08); }
    .gb-header.cloud {
      background: #f3e8ff; color: #6b21a8; border: 2px dashed #c084fc;
      border-radius: 24px; padding: 14px 16px;
    }
    .gb-header .title { font-size: 22px; line-height: 1.2; display:block; }
    .gb-header .subtitle { font-size: 15px; font-weight: 700; color: #4c1d95; margin-top: 4px; display:block; }

    /* Intro bubble */
    .gb-intro {
      text-align: center; font-size: 16px; line-height: 1.6; margin: 0 0 10px; color: #374151;
      background: #e0f2fe; border-radius: 8px; padding: 10px 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.06);
    }

    /* Keep the Glowbit two-column shell centered & not full-bleed */
    .glowbit-root { max-width: 1100px; margin: 0 auto; padding: 0 12px; display: block; }

    /* Ensure Blockly gets real height â€” otherwise it wonâ€™t render */
    #break-logic-playground-editor {
  height: 560px; min-height: 560px; max-width: 720px; margin: 0 auto; box-sizing: border-box;
}
/* (Optional) visual debugging while you test */
.glowbit-editor { background:#fff; }

    .glowbit-left, .glowbit-right { box-sizing: border-box; }

    .didyouknow {
      margin-top: 18px; background: #fef9c3; border: 2px solid #facc15; padding: 10px 12px;
      border-radius: 12px; color: #713f12; font-size: 15px; font-weight: 600; position: relative;
      box-shadow: 0 2px 5px rgba(0,0,0,0.06);
    }
    .didyouknow::before {
      content:""; position:absolute; top:-10px; left:20px; border-width:0 10px 10px 10px;
      border-style:solid; border-color:transparent transparent #fef9c3 transparent;
    }
    .didyouknow p { text-align: justify; margin: 6px 0; }

    .nav-btns { display: flex; justify-content: space-between; gap: 8px; margin-top: 10px; flex-wrap: wrap; }
    .gb-btn { padding: 8px 14px; border: none; border-radius: 8px; font-weight: 800; cursor: pointer; flex: 1; text-align: center; }
    .gb-btn.next { background: #00A1D6; color: #fff; }
    .gb-btn.back { background: #6B7280; color: #fff; }
    .gb-btn.cta  { background: #10B981; color: #fff; display: block; margin: 12px auto 0; }

    .character-frame { text-align: center; margin-top: 18px; }
    .character-frame img {
      width: 85%; max-width: 260px; height: auto; border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,.25); object-fit: cover;
    }

    .pill-row { display: flex; gap: 8px; flex-wrap: wrap; margin: 8px 0 }
    .pill { background:#e2e8f0; color:#0f172a; border:1px solid #94a3b8; border-radius:999px; padding:6px 12px; font-weight:700; }
    .callout { background:#ecfeff; border-left:6px solid #06b6d4; padding:8px 10px; border-radius:8px; color:#0f172a; margin:8px 0; }
    .mini-badge { display:inline-block; background:#fde68a; color:#92400e; border:1px solid #f59e0b;
                  border-radius:6px; padding:2px 6px; font-size:12px; font-weight:800; margin-left:6px; }
  </style>
</head>

<body>
  <div class="gb-wrapper">
    <div class="gb-header cloud">
      <span class="title">âœ¨ Expand Your Knowledge â€” Logical Conditions & Comparisons</span>
      <span class="subtitle">Teach GlowBit to make decisions like a tiny robot brain</span>
    </div>

    <p class="gb-intro">
      This is a fun pit-stop between Projects 7 and 8. Youâ€™ll learn <strong>Ifâ€“Thenâ€“Else</strong>
      and <strong>Comparisons</strong> (<span class="pill">&gt;</span> <span class="pill">&lt;</span> <span class="pill">=</span>)
      so your next projects feel easy. Letâ€™s practice!
    </p>

    <!-- Standard lesson shell; right pane hosts the Blockly editor -->
    <div id="break-logic-playground"></div>
  </div>

  <script>
(function init(){
  // Wait until both Glowbit + Blockly are available
  if(!(window.Glowbit && window.Blockly)) return setTimeout(init,120);

  // --- Starter program: Button A â†’ IF TRUE then heart else smile ---
  const starterJson = {
    blocks:{
      languageVersion:0,
      blocks:[
        {
          type:"on_button_pressed",
          fields:{ BTN:"A" },             // use BTN (your global.js field name)
          x:20, y:20,
          inputs:{
            DO:{
              block:{
                type:"controls_if",
                extraState:{ elseIfCount:0, hasElse:true },
                inputs:{
                  IF0:{ block:{ type:"logic_boolean", fields:{ BOOL:"TRUE" } } },
                  DO0:{ block:{
                    type:"show_icon", fields:{ ICON:"heart" },
                    next:{ block:{ type:"pause_block", fields:{ MS:400 },
                      next:{ block:{ type:"clear_screen" } } }
                  }},
                  ELSE:{ block:{
                    type:"show_icon", fields:{ ICON:"smile" },
                    next:{ block:{ type:"pause_block", fields:{ MS:400 },
                      next:{ block:{ type:"clear_screen" } } }
                  }}
                }
              }
            }
          }
        }
      ]
    }
  };

  // --- Build the two-column shell exactly like projects ---
  const lesson = Glowbit.createLessonUI('break-logic-playground', {
    title: '',
    instructions: '',
    pixelSize: 28,
    // IMPORTANT: non-null defaultJson so Blockly injects with toolbox
    defaultJson: { blocks:{ languageVersion:0, blocks:[] } }
  });

  // Ensure the editor div has height before load (required for visibility)
  const editorEl = document.getElementById('break-logic-playground-editor');
  if (editorEl && !editorEl.style.height) editorEl.style.height = '560px';

  // Optional safety: if your toolbox isnâ€™t auto-attached, attach it
  if (lesson && lesson.workspace) {
    const tb = (Glowbit.toolboxXml || Glowbit.toolbox || Glowbit.TOOLBOX_XML || null);
    if (tb) {
      try { lesson.workspace.updateToolbox(tb); } catch(e) { console.warn('Toolbox update skipped', e); }
    }
  }

  // Load the starter blocks, nudge layout
  if (lesson && lesson.workspace) {
    lesson.workspace.clear();
    Blockly.serialization.workspaces.load(starterJson, lesson.workspace);
    setTimeout(()=>Blockly.svgResize(lesson.workspace), 0);
  }

  // --- AUTO-RUN once so event handlers (Button A) are registered upfront ---
  function autoRunOnce(){
    try {
      // 1) If createLessonUI exposed a run method
      if (lesson && typeof lesson.runProgram === 'function') { lesson.runProgram(); return; }

      // 2) If global handler exists (common in your global.js)
      if (typeof window.runProgram === 'function') {
        // call it with a fake button context if needed
        window.runProgram.call(document.querySelector('#break-logic-playground button') || window);
        return;
      }

      // 3) Fallback: click a Run/Play button if your UI exposes one
      const runBtn = document.querySelector(
        '#break-logic-playground .gb-run, ' +
        '#break-logic-playground [data-role="run"], ' +
        'button.gb-run, button[data-role="run"]'
      );
      if (runBtn) { runBtn.click(); return; }

      console.warn('Auto-run: no run handler/button found; press Run once manually.');
    } catch(e) {
      console.warn('Auto-run error:', e);
    }
  }
  // Give the DOM a tick to finish, then run
  setTimeout(autoRunOnce, 50);

  // --- Sidebar content (unchanged from your last working version) ---
  const stepCards = [
`<div style="display:flex;align-items:center;gap:12px;justify-content:center;margin-bottom:4px;"></div>
<h3 style="text-align:center;color:#6b21a8;">Welcome to the Logic Playground!</h3>
<div class="callout" style="border-left-color:#a78bfa;">
 Teach GlowBit to make choices. Youâ€™ll learn <strong>Ifâ€“Thenâ€“Else</strong> and <strong>Comparisons</strong>
 to prepare for <strong>your next projects</strong>.
</div>
<div>
 <strong>Real-life logic:</strong><br>
 â€¢ ğŸŒ§ï¸ If itâ€™s raining â†’ Then take umbrella â†’ Else wear a cap.<br>
 â€¢ ğŸ® If battery &gt; 50 â†’ Then keep playing â†’ Else charge it.<br>
 â€¢ ğŸš¦ If light is green â†’ Then go â†’ Else wait.
</div>`,

`<h3 id="logic-steps" style="text-align:center;color:#0f5132;">Ifâ€“Thenâ€“Else (Build it with the Gear)</h3>
<div style="margin:10px 0;padding:10px;border-radius:8px;background:#d1fae5;color:#0f5132;">
  <div>1) From <strong>Logic</strong>, drag an <strong>if</strong> block into your Workspace.</div>
  <div>2) Click the tiny gear to open the <strong>mutator</strong> panel.</div>
  <div>3) Drag an <strong>else</strong> piece into the structure so it reads: <em>if â€¦ do â€¦ else â€¦</em></div>
  <div>4) Close the panel â€” you now have a full <strong>Ifâ€“Thenâ€“Else</strong> block!</div>
  <div class="mini-badge">Tip</div> Put blocks in the <em>then</em> and <em>else</em> parts to see different results.
</div>`,

`<h3 style="text-align:center;color:#0f172a;">Comparisons: Three Symbols</h3>
<div style="margin:10px 0;padding:10px;border-radius:8px;background:#e0f2fe;color:#0f172a;">
 <ol style="margin:0 0 6px 18px;">
   <li><strong>=</strong> means â€œis equal toâ€. Example: <code>120 = 120</code> âœ…</li>
   <li><strong>&lt;</strong> means â€œis less thanâ€. Example: <code>80 &lt; 120</code> âœ…</li>
   <li><strong>&gt;</strong> means â€œis greater thanâ€. Example: <code>150 &gt; 120</code> âœ…</li>
 </ol>
 <div style="margin-top:8px;">Change the symbol using the dropdown on the compare block.</div>
</div>`,

`<h3 style="text-align:center;color:#0f172a;">What are we comparing?</h3>
<div style="margin:10px 0;padding:10px;border-radius:8px;background:#f1f5f9;color:#0f172a;">
  Think of a comparison as <strong>X ? Y</strong> where <strong>?</strong> is one of <strong>=</strong>, <strong>&lt;</strong>, <strong>&gt;</strong>.<br><br>
  <ul style="margin:0 0 6px 18px;">
    <li><strong>X</strong> (left side) can be a <em>changing sensor value</em> like <strong>sound level</strong>.</li>
    <li><strong>Y</strong> (right side) is often a <em>fixed number</em> (a threshold), like <strong>100</strong> or <strong>120</strong>.</li>
  </ul>
  Examples:<br>
  â€¢ <code>sound level &gt; 120</code> â†’ loud<br>
  â€¢ <code>sound level &lt; 100</code> â†’ quiet
</div>`,

`<h3 style="text-align:center;color:#065f46;">Challenge: Button A + Ifâ€“Thenâ€“Else</h3>
<div style="margin:10px 0;padding:10px;border-radius:8px;background:#d1fae5;color:#065f46;">
  <strong>Goal:</strong> When you press <strong>Button A</strong>, check the sound. If itâ€™s quiet, show a heart; otherwise, show a smile.<br><br>
  <ol style="margin:0 0 6px 18px;">
    <li>From <strong>Input</strong>, drag <strong>on button A pressed</strong> to the Workspace.</li>
    <li>From <strong>Logic</strong>, drag an <strong>if</strong> block inside it. Click the <strong>gear</strong> and add <strong>else</strong>.</li>
    <li>From <strong>Logic</strong>, drag a <strong>compare</strong> block (A ? B) into the ifâ€™s slot. Change <code>?</code> to <strong>&lt;</strong>.</li>
    <li>From <strong>Input</strong>, place <strong>sound level</strong> in the left side (A). From <strong>Math</strong>, place a <strong>number</strong> <code>100</code> on the right side (B).</li>
    <li>In the <strong>then</strong> part: add <strong>show icon â†’ heart</strong> (optional: then a <strong>pause 400 ms</strong> and <strong>clear screen</strong>).</li>
    <li>In the <strong>else</strong> part: add <strong>show icon â†’ smile</strong> (optional pause + clear).</li>
    <li>Click <strong>Run</strong> (already done for you), then press <strong>A</strong>. Try speaking softly vs loudlyâ€”does it switch?</li>
  </ol>
</div>`,

`<h3 style="text-align:center;color:#00A1D6;">Practice Zone</h3>
<div style="margin:10px 0;padding:10px;border-radius:8px;background:#e0f2fe;color:#0f172a;">
  <div><strong>Practice 1 â€” â€œShhh or Loudâ€</strong><br>
  If <em>sound level &gt; 120</em> â†’ show <strong>â€œLOUDâ€</strong>; else show <strong>â€œssshâ€</strong>.</div>
  <hr style="border:none;border-top:1px dashed #94a3b8;margin:10px 0;">
  <div><strong>Practice 2 â€” â€œBright vs Dimâ€</strong><br>
  If <em>sound level &lt; 100</em> â†’ set brightness <strong>50</strong>; else <strong>200</strong>.</div>
</div>`,

`<h3 style="text-align:center;color:#00A1D6;">Did You Know?</h3>
<div class="didyouknow">
  ğŸ’¡ <strong>Real-world logic is everywhere:</strong>
  <p>ğŸš¶ Crosswalks: If the button is pressed â†’ then walk signal; else wait.</p>
  <p>ğŸŒ¡ï¸ Thermostats: If temperature &lt; target â†’ then heat; else stop.</p>
  <p>ğŸ—£ï¸ Smart speakers: If wake word heard â†’ then listen; else sleep.</p>
  <p>ğŸ­ Factory lights: If a machine is too loud/hot â†’ then alert.</p>
</div>
<a class="gb-btn cta" href="./glowbit-project8.html">Ready for Sound Alerts? â†’ Go to Project 8</a>`
  ];

  // --- Sidebar pagination + character image (unchanged) ---
  function paginate(){
    const sidebar = document.querySelector('#break-logic-playground .glowbit-left');
    if(!sidebar) return;
    const editor = document.getElementById('break-logic-playground-editor');
    const targetH = (editor && editor.offsetHeight) ? editor.offsetHeight : 560;

    const meas = document.createElement('div');
    meas.style.visibility='hidden'; meas.style.position='absolute';
    meas.style.left='-9999px'; meas.style.top='-9999px';
    meas.style.width = (sidebar.clientWidth || 320) + 'px';
    document.body.appendChild(meas);

    const pages = []; let current = []; const reserve = 56;
    stepCards.forEach(html=>{
      const c = document.createElement('div'); c.innerHTML = html; meas.appendChild(c);
      const tooTall = meas.scrollHeight > (targetH - reserve);
      if(tooTall){
        if(current.length===0){ pages.push([html]); meas.innerHTML=''; }
        else {
          pages.push([...current]); current=[html]; meas.innerHTML='';
          current.forEach(h=>{ const d=document.createElement('div'); d.innerHTML=h; meas.appendChild(d); });
        }
      } else {
        current.push(html);
      }
    });
    if(current.length) pages.push(current);
    document.body.removeChild(meas);

    function render(i){
      sidebar.innerHTML = pages[i].join('');

      const nav = document.createElement('div');
      nav.className = 'nav-btns';
      if(i>0){ const b=document.createElement('button'); b.textContent='â¬… Back'; b.className='gb-btn back'; b.onclick=()=>render(i-1); nav.appendChild(b); }
      if(i<pages.length-1){ const n=document.createElement('button'); n.textContent='Next âœ'; n.className='gb-btn next'; n.onclick=()=>render(i+1); nav.appendChild(n); }
      if(nav.children.length) sidebar.appendChild(nav);

      const frame = document.createElement('div');
      frame.className = 'character-frame';
      frame.innerHTML = `<img src="images/GlowBit3.png" alt="GlowBit buddy">`;
      sidebar.appendChild(frame);
    }
    render(0);
  }
  paginate();

  // Simple resize handler
  window.addEventListener('resize', ()=>{
    paginate();
    if (lesson && lesson.workspace) Blockly.svgResize(lesson.workspace);
  });

  console.log('âœ… Logic Playground page ready.');
})();
</script>
</body>
</html>

