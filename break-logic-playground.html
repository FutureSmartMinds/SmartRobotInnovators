<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GlowBit Logic Playground — If, Then, Else (and Comparisons!)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Cache-Control" content="no-store" />

  <!-- Core libs (cache-busted) -->
  <script src="lib/blockly_compressed.js?v=lp3"></script>
  <script src="lib/blocks_compressed.js?v=lp3"></script>
  <script src="lib/javascript_compressed.js?v=lp3"></script>
  <script src="lib/msg/en.js?v=lp3"></script>
  <script src="assets/global.js?v=lp3"></script>
  <script src="lib/blockly_xml_patch.js?v=lp3"></script>

  <style>
    /* Page wrapper: center like your projects */
    .gb-wrapper {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 12px;
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
    }

    /* Header (cloud look) — centered title + subtitle */
    .gb-header { text-align: center; font-weight: 800; margin: 10px 0; box-shadow: 0 1px 4px rgba(0,0,0,0.08); }
    .gb-header.cloud {
      background: #f3e8ff; color: #6b21a8; border: 2px dashed #c084fc;
      border-radius: 24px; padding: 14px 16px;
    }
    .gb-header .title { font-size: 22px; line-height: 1.2; display:block; }
    .gb-header .subtitle { font-size: 15px; font-weight: 700; color: #4c1d95; margin-top: 4px; display:block; }

    /* Intro bubble */
    .gb-intro {
      text-align: center; font-size: 16px; line-height: 1.6; margin: 0 0 10px; color: #374151;
      background: #e0f2fe; border-radius: 8px; padding: 10px 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.06);
    }

    /* Keep the Glowbit two-column shell centered & not full-bleed */
    .glowbit-root { max-width: 1100px; margin: 0 auto; padding: 0 12px; display: block; }

    /* Ensure Blockly gets real height — otherwise it won’t render */
    #break-logic-playground-editor {
  height: 560px; min-height: 560px; max-width: 720px; margin: 0 auto; box-sizing: border-box;
}
/* (Optional) visual debugging while you test */
.glowbit-editor { background:#fff; }

    .glowbit-left, .glowbit-right { box-sizing: border-box; }

    .didyouknow {
      margin-top: 18px; background: #fef9c3; border: 2px solid #facc15; padding: 10px 12px;
      border-radius: 12px; color: #713f12; font-size: 15px; font-weight: 600; position: relative;
      box-shadow: 0 2px 5px rgba(0,0,0,0.06);
    }
    .didyouknow::before {
      content:""; position:absolute; top:-10px; left:20px; border-width:0 10px 10px 10px;
      border-style:solid; border-color:transparent transparent #fef9c3 transparent;
    }
    .didyouknow p { text-align: justify; margin: 6px 0; }

    .nav-btns { display: flex; justify-content: space-between; gap: 8px; margin-top: 10px; flex-wrap: wrap; }
    .gb-btn { padding: 8px 14px; border: none; border-radius: 8px; font-weight: 800; cursor: pointer; flex: 1; text-align: center; }
    .gb-btn.next { background: #00A1D6; color: #fff; }
    .gb-btn.back { background: #6B7280; color: #fff; }
    .gb-btn.cta  { background: #10B981; color: #fff; display: block; margin: 12px auto 0; }

    .character-frame { text-align: center; margin-top: 18px; }
    .character-frame img {
      width: 85%; max-width: 260px; height: auto; border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,.25); object-fit: cover;
    }

    .pill-row { display: flex; gap: 8px; flex-wrap: wrap; margin: 8px 0 }
    .pill { background:#e2e8f0; color:#0f172a; border:1px solid #94a3b8; border-radius:999px; padding:6px 12px; font-weight:700; }
    .callout { background:#ecfeff; border-left:6px solid #06b6d4; padding:8px 10px; border-radius:8px; color:#0f172a; margin:8px 0; }
    .mini-badge { display:inline-block; background:#fde68a; color:#92400e; border:1px solid #f59e0b;
                  border-radius:6px; padding:2px 6px; font-size:12px; font-weight:800; margin-left:6px; }
  </style>
</head>

<body>
  <div class="gb-wrapper">
    <div class="gb-header cloud">
      <span class="title">✨ Expand Your Knowledge — Logical Conditions & Comparisons</span>
      <span class="subtitle">Teach GlowBit to make decisions like a tiny robot brain</span>
    </div>

    <p class="gb-intro">
      This is a fun pit-stop between Projects 7 and 8. You’ll learn <strong>If–Then–Else</strong>
      and <strong>Comparisons</strong> (<span class="pill">&gt;</span> <span class="pill">&lt;</span> <span class="pill">=</span>)
      so your next projects feel easy. Let’s practice!
    </p>

    <!-- Standard lesson shell; right pane hosts the Blockly editor -->
    <div id="break-logic-playground"></div>
  </div>

  <script>
(function init(){
  if(!(window.Glowbit && window.Blockly)) return setTimeout(init,120);

  // --- Helpers to keep JSON tiny & readable ---
  function chain(list){
    for (let i=0;i<list.length-1;i++) list[i].next = { block: list[i+1] };
    return list[0];
  }
  function inp(name, block){ return { [name]: { block } }; }

  // --- Sequences: heart → pause → clear, smile → pause → clear ---
  const heartSeq = chain([
    { type:"show_icon",   fields:{ ICON:"heart" } },
    { type:"pause_block", fields:{ MS:400 } },
    { type:"clear_screen" }
  ]);
  const smileSeq = chain([
    { type:"show_icon",   fields:{ ICON:"smile" } },
    { type:"pause_block", fields:{ MS:400 } },
    { type:"clear_screen" }
  ]);

  // --- IF TRUE then heart ELSE smile ---
  const ifBlock = {
    type: "controls_if",
    extraState: { elseIfCount: 0, hasElse: true },
    inputs: Object.assign(
      {},
      inp("IF0",  { type:"logic_boolean", fields:{ BOOL:"TRUE" } }),
      inp("DO0",  heartSeq),
      { ELSE: { block: smileSeq } }
    )
  };

  // --- Top-level: on_button_pressed (BTN:"A") with the IF inside ---
  const starterBlock = {
    type: "on_button_pressed",
    fields: { BTN: "A" },         // use BTN (your global.js field name)
    x: 20, y: 20,
    inputs: inp("DO", ifBlock)
  };

  const starterJson = {
    blocks: {
      languageVersion: 0,
      blocks: [ starterBlock ]
    }
  };

  // --- Build the standard two-column UI (MUST NOT be null) ---
  const lesson = Glowbit.createLessonUI('break-logic-playground', {
    title: '',
    instructions: '',
    pixelSize: 28,
    defaultJson: { blocks:{ languageVersion:0, blocks:[] } }
  });

  // Ensure the editor has height so Blockly draws
  const editorEl = document.getElementById('break-logic-playground-editor');
  if (editorEl && !editorEl.style.height) editorEl.style.height = '560px';

  // Load blocks and nudge layout
  if (lesson && lesson.workspace) {
    lesson.workspace.clear();
    Blockly.serialization.workspaces.load(starterJson, lesson.workspace);
    setTimeout(() => Blockly.svgResize(lesson.workspace), 0);
  }

  // Auto-run once so Button A handler is registered upfront
  setTimeout(() => {
    try {
      if (lesson && typeof lesson.runProgram === 'function') lesson.runProgram();
      else if (typeof window.runProgram === 'function') window.runProgram();
    } catch(e){ console.warn('Auto-run skipped:', e); }
  }, 60);

  console.log('✅ Logic Playground page ready.');
})();
</script>
</body>
</html>

