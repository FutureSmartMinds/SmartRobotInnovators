<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>(10) Mia‚Äôs GlowBit ChatBot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Same required script order as P8/P9 -->
  <script src="lib/blockly_compressed.js"></script>
  <script src="lib/blocks_compressed.js"></script>
  <script src="lib/javascript_compressed.js"></script>
  <script src="lib/msg/en.js"></script>
  <script src="assets/global.js"></script>
  <script src="lib/blockly_xml_patch.js"></script>

  <style>
    .gb-wrapper{max-width:1100px;margin:0 auto;font-family:"Segoe UI",Roboto,Arial,sans-serif;}
    .gb-header{text-align:center;background:#fef2f2;color:#be123c;font-size:22px;font-weight:800;
               padding:10px 12px;border-radius:12px;margin:8px 0 6px;box-shadow:0 1px 4px rgba(0,0,0,0.08);}
    .gb-subhead{text-align:center;background:#fff7ed;color:#c2410c;font-size:16px;font-weight:700;
                padding:8px 12px;border-radius:10px;margin:0 0 10px;box-shadow:0 1px 3px rgba(0,0,0,0.06);}
    .callout{background:#f1f5f9;border-left:6px solid #64748b;padding:10px 12px;border-radius:10px;color:#0f172a;margin:8px 0;}
    .tip{display:inline-block;background:#fde68a;color:#92400e;border:1px solid #f59e0b;border-radius:6px;padding:2px 6px;font-size:12px;font-weight:800;}
    .nav-btns{display:flex;justify-content:space-between;gap:8px;margin-top:10px;flex-wrap:wrap;}
    .gb-btn{padding:8px 14px;border:none;border-radius:8px;font-weight:700;cursor:pointer;flex:1;text-align:center;}
    .gb-btn.next{background:#00A1D6;color:#fff;}
    .gb-btn.back{background:#6B7280;color:#fff;}
    .gb-btn.cta{background:#16a34a;color:#fff;margin-top:8px;}
    .character-frame{text-align:center;margin-top:18px;}
    .character-frame img{width:85%;max-width:260px;height:auto;border-radius:12px;
                         box-shadow:0 4px 12px rgba(0,0,0,0.25);object-fit:cover;}
    #glowbit-project10-editor{height:560px;min-height:560px;background:#fff;}

    /* Compact Check-Your-Setup modal (same pattern as P8/P9) */
    #solutionModalP10{display:none;position:fixed;top:60px;right:20px;width:640px;max-width:42%;
      background:#fff;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,0.28);
      z-index:12000;overflow:hidden;user-select:none;}
    #solutionHeaderP10{cursor:move;padding:10px 12px;background:#be123c;color:#fff;font-weight:700;
      text-align:left;border-radius:10px 10px 0 0;display:flex;justify-content:space-between;align-items:center;}
    #solutionWorkspaceP10{height:360px;width:100%;border-top:1px solid #eee;background:#fafafa;}
    #solutionFooterP10{text-align:center;padding:12px;background:#fff;}
    #solutionFooterP10 button{background:#be123c;color:#fff;border:none;border-radius:8px;
      padding:8px 18px;cursor:pointer;font-weight:700;}
    @media(max-width:900px){
      #solutionModalP10{left:10px;right:10px;width:auto;max-width:calc(100% - 20px);top:40px;}
      #solutionWorkspaceP10{height:260px;}
    }
  </style>
</head>

<body>
  <div class="gb-wrapper">
    <div class="gb-header">(10) Mia‚Äôs GlowBit ChatBot</div>
    <div class="gb-subhead">
      Let‚Äôs make GlowBit welcome you! You‚Äôll code GlowBit to display a welcome message and count from 1 to 10 ‚Äî like a smart chatbot.
    </div>

    <div id="glowbit-project10"></div>
  </div>

  <!-- ‚úÖ Compact Solution Modal -->
  <div id="solutionModalP10" aria-hidden="true" role="dialog">
    <div id="solutionHeaderP10">
      <div>‚úÖ Correct Setup ‚Äî ChatBot</div>
      <button id="solutionCloseP10" title="Close">‚úï</button>
    </div>
    <div id="solutionWorkspaceP10" aria-label="Correct solution workspace"></div>
    <div id="solutionFooterP10"><button id="solutionCloseBtnP10">Close</button></div>
  </div>

  <script>
  (function boot(){
    if(!(window.Glowbit && window.Blockly)) return setTimeout(boot,120);

    /* Standard two-column UI */
    const lesson = Glowbit.createLessonUI('glowbit-project10', {
      title:'',instructions:'',pixelSize:28,
      defaultJson:{blocks:{languageVersion:0,blocks:[]}}
    });
    if(lesson && lesson.workspace) lesson.workspace.clear();

    /* ---------- Correct Answer JSON (matches your requested structure) ---------- */
    const VAR_ID = "VAR_COUNT_ID_1"; // stable id for 'Count'
    const solutionJson = {
      variables: [{name:"Count", id:VAR_ID}],
      blocks:{languageVersion:0,blocks:[
        {
          type:"on_start", x:20, y:20,
          inputs:{DO:{block:{
            type:"show_text", fields:{TEXT:"Welcome!"},
            next:{block:{
              type:"variables_set", fields:{VAR:{id:VAR_ID,name:"Count"}},
              inputs:{VALUE:{shadow:{type:"math_number",fields:{NUM:1}}}}
            }}
          }}}
        },
        {
          type:"on_button_pressed", x:20, y:200, fields:{BTN:"A"},
          inputs:{DO:{block:{
            type:"controls_if",
            extraState:{elseIfCount:0, hasElse:true},
            inputs:{
              IF0:{block:{
                type:"logic_compare", fields:{OP:"LT"},
                inputs:{
                  A:{block:{type:"variables_get", fields:{VAR:{id:VAR_ID,name:"Count"}}}},
                  B:{block:{type:"math_number", fields:{NUM:10}}}
                }
              }},
              DO0:{block:{
                /* Set Count to Count + 1 (explicit to avoid 'change' block id differences) */
                type:"variables_set", fields:{VAR:{id:VAR_ID,name:"Count"}},
                inputs:{VALUE:{block:{
                  type:"math_arithmetic", fields:{OP:"ADD"},
                  inputs:{
                    A:{block:{type:"variables_get", fields:{VAR:{id:VAR_ID,name:"Count"}}}},
                    B:{block:{type:"math_number", fields:{NUM:1}}}
                  }
                }}}
              }},
              ELSE:{block:{
                /* Else: Set Count to 1, then Show Number 1 */
                type:"variables_set", fields:{VAR:{id:VAR_ID,name:"Count"}},
                inputs:{VALUE:{shadow:{type:"math_number",fields:{NUM:1}}}},
                next:{block:{
                  type:"show_number",
                  inputs:{NUM:{shadow:{type:"math_number",fields:{NUM:1}}}}
                }}
              }}
            }
          }}}
        }
      ]}
    };
    window.solutionJson = solutionJson;

    /* ---------- Sidebar slides (emoji bullets, explicit tabs, no music) ---------- */
    const stepCards = [

`<h3 style="text-align:center;color:#be123c;">Step 1 ‚Äî Show a Welcome Message</h3>
<div class="callout">
  üß∞ Go to the <strong>Basic</strong> tab and drag a <strong>show text</strong> block to the Workspace. Type <em>Welcome!</em> in the text field.<br>
  üöÄ From <strong>Basic</strong>, drag <strong>on start</strong> and place <em>show text ‚ÄúWelcome!‚Äù</em> inside it.<br>
  ‚ñ∂Ô∏è Click <strong>Run</strong> to see the message on the LED grid.<br>
  üí¨ Mia: ‚ÄúGlowBit says Welcome!‚Äù<br><br>
  4Ô∏è‚É£ üßπ Remove the block from <em>on start</em> after testing.
</div>`,

`<h3 style="text-align:center;color:#be123c;">Step 2 ‚Äî Show the Number 1</h3>
<div class="callout">
  üß∞ From the <strong>Basic</strong> tab, drag a <strong>show number</strong> block to the Workspace.<br>
  üî¢ From the <strong>Math</strong> tab, drag <strong>number</strong> (defaults to <code>0</code>), change it to <code>1</code>, and <em>snap it into</em> the <strong>show number</strong> block.<br>
  üöÄ From <strong>Basic</strong>, drag <strong>on start</strong> and place <em>show number (1)</em> inside it.<br>
  ‚ñ∂Ô∏è Click <strong>Run</strong> to see ‚Äú1‚Äù.<br><br>
  üßπ Remove it from <em>on start</em> after testing.
</div>`,

`<h3 style="text-align:center;color:#be123c;">Step 3 ‚Äî Add Button A</h3>
<div class="callout">
  1Ô∏è‚É£ üîò From <strong>Input</strong>, drag <strong>on button A pressed</strong> to the Workspace.<br>
  2Ô∏è‚É£ (We‚Äôll make it count in the next step.)
</div>`,

`<h3 style="text-align:center;color:#be123c;">Step 4A ‚Äî Create and Set the Count Variable</h3>
<div class="callout">
  1Ô∏è‚É£ üî¢ From the <strong>Variables</strong> tab, click <strong>Make a Variable</strong> and name it <em>Count</em>.<br>
  2Ô∏è‚É£ üöÄ From the <strong>Basic</strong> tab, drag an <strong>on start</strong> block to the Workspace.<br>
  3Ô∏è‚É£ üß© From the <strong>Variables</strong> tab, drag <strong>set Count to</strong> and place it inside <em>on start</em>.<br>
  4Ô∏è‚É£ üî¢ From the <strong>Math</strong> tab, drag <strong>number</strong> (defaults to <code>0</code>), change it to <code>1</code>, and snap it into the right side of <em>set Count to</em>.<br>
  ‚ñ∂Ô∏è Click <strong>Run</strong> to confirm no errors. (You won‚Äôt see a display yet ‚Äî that‚Äôs next!)
</div>`,

`<h3 style="text-align:center;color:#be123c;">Step 4B ‚Äî Make GlowBit Count with You</h3>
<div class="callout">
  1Ô∏è‚É£ üîò Select your <strong>on button A pressed</strong> block from Step 3.<br>
  2Ô∏è‚É£ ‚öôÔ∏è From <strong>Logic</strong>, drag an <strong>if then</strong> block, click the ‚öôÔ∏è icon, and add an <strong>else</strong> piece.<br>
  3Ô∏è‚É£ In the <em>if</em> slot:<br>
  &nbsp;&nbsp;&nbsp;&nbsp;‚Ä¢ From <strong>Logic</strong>, drag a <strong>compare</strong> block (<strong>&lt;</strong>).<br>
  &nbsp;&nbsp;&nbsp;&nbsp;‚Ä¢ From <strong>Variables</strong>, drag <strong>Count</strong> (getter) into the left side.<br>
  &nbsp;&nbsp;&nbsp;&nbsp;‚Ä¢ From <strong>Math</strong>, drag <strong>number</strong>, set it to <code>10</code>, and snap it into the right side.<br><br>
  4Ô∏è‚É£ In the <em>then</em> area (Count &lt; 10):<br>
  &nbsp;&nbsp;&nbsp;&nbsp;‚Ä¢ From <strong>Variables</strong>, drag <strong>set Count to</strong>.<br>
  &nbsp;&nbsp;&nbsp;&nbsp;‚Ä¢ From <strong>Math</strong>, drag <strong>arithmetic</strong> (set to +).<br>
  &nbsp;&nbsp;&nbsp;&nbsp;‚Ä¢ Put <strong>Count</strong> (getter) on the left (A) and <strong>number 1</strong> on the right (B).<br>
  &nbsp;&nbsp;&nbsp;&nbsp;‚Ä¢ Optionally, from <strong>Basic</strong> add <strong>show number</strong> and snap in <strong>Count</strong> (getter) so it displays each count.<br><br>
  5Ô∏è‚É£ In the <em>else</em> area (when Count = 10):<br>
  &nbsp;&nbsp;&nbsp;&nbsp;‚Ä¢ From <strong>Variables</strong>, drag <strong>set Count to</strong> and snap in <strong>number 1</strong>.<br>
  &nbsp;&nbsp;&nbsp;&nbsp;‚Ä¢ From <strong>Basic</strong>, drag <strong>show number</strong> and snap in <strong>number 1</strong>.<br><br>
  ‚ñ∂Ô∏è Click <strong>Run</strong>, press <strong>Button A</strong>, and GlowBit will count from 1 ‚Üí 10 then restart at 1.<br>
  üí¨ Mia: ‚ÄúGlowBit counts with me!‚Äù
</div>`
`<div class="callout" style="text-align:center;">
  <button class="gb-btn cta" id="open-solution">‚úÖ Check Your Setup</button>
</div>`,

`<h3 style="text-align:center;color:#00A1D6;">Did You Know?</h3>
<div class="callout">
  ‚Ä¢ üí¨ <strong>Chatbots & devices</strong> often greet you with a welcome message on tiny displays ‚Äî just like our Show Text block.<br>
  ‚Ä¢ üî¢ <strong>Counters are everywhere</strong>: elevators show floor numbers, turnstiles count entries, and apps track steps ‚Äî your <em>Count</em> variable works the same way!<br>
  ‚Ä¢ üß† <strong>Reset-on-limit</strong> is common: scoreboards, timers, and click counters loop back to a start value after they reach a max.
</div>
<div class="callout">
  <span class="tip">Try this</span> After each press, add <strong>show number Count</strong> (Variables ‚Üí Count getter into Basic ‚Üí show number) so GlowBit displays the current count every time.
</div>`
    ];

    /* ---------- Sliding pagination (same as P8/P9) ---------- */
    function paginate(){
      const sidebar=document.querySelector('#glowbit-project10 .glowbit-left');
      if(!sidebar)return;
      const editor=document.getElementById('glowbit-project10-editor');
      const targetH=(editor&&editor.offsetHeight)?editor.offsetHeight:520;

      const meas=document.createElement('div');
      meas.style.visibility='hidden';meas.style.position='absolute';meas.style.left='-9999px';
      meas.style.width=(sidebar.clientWidth||320)+'px';document.body.appendChild(meas);

      const pages=[];let current=[];const reserve=56;
      stepCards.forEach(html=>{
        const c=document.createElement('div');c.innerHTML=html;meas.appendChild(c);
        const tooTall=meas.scrollHeight>(targetH-reserve);
        if(tooTall){
          if(current.length===0){pages.push([html]);meas.innerHTML='';}
          else{pages.push([...current]);current=[html];meas.innerHTML='';
            current.forEach(h=>{const d=document.createElement('div');d.innerHTML=h;meas.appendChild(d);});}
        }else current.push(html);
      });
      if(current.length)pages.push(current);
      document.body.removeChild(meas);

      function render(i){
        sidebar.innerHTML=pages[i].join('');
        const nav=document.createElement('div');nav.className='nav-btns';
        if(i>0){const b=document.createElement('button');b.textContent='‚¨Ö Back';b.className='gb-btn back';b.onclick=()=>render(i-1);nav.appendChild(b);}
        if(i<pages.length-1){const n=document.createElement('button');n.textContent='Next ‚ûú';n.className='gb-btn next';n.onclick=()=>render(i+1);nav.appendChild(n);}
        sidebar.appendChild(nav);

        const frame=document.createElement('div');frame.className='character-frame';
        frame.innerHTML='<img src="images/GlowBit3.png" alt="GlowBit buddy">';sidebar.appendChild(frame);

        const openBtn=document.getElementById('open-solution');
        if(openBtn)openBtn.addEventListener('click',()=>showSolutionModal());
      }
      render(0);
    }
    paginate();
    window.addEventListener('resize',()=>{paginate();if(lesson&&lesson.workspace)Blockly.svgResize(lesson.workspace);});

    /* ---------- Compact modal behavior ---------- */
    const modal=document.getElementById('solutionModalP10');
    const wsDiv=document.getElementById('solutionWorkspaceP10');
    const closeBtns=[document.getElementById('solutionCloseP10'),document.getElementById('solutionCloseBtnP10')];
    function showSolutionModal(){
      modal.style.display='block';wsDiv.innerHTML='';
      const ws=Blockly.inject(wsDiv,{readOnly:true,scrollbars:true});
      Blockly.serialization.workspaces.load(window.solutionJson,ws);
    }
    closeBtns.forEach(b=>b.addEventListener('click',()=>modal.style.display='none'));

    console.log('‚úÖ Project 10 ‚Äì ChatBot ready: corrected steps, variables logic, no music, sliding sidebar, compact modal.');
  })();
  </script>
</body>
</html>
