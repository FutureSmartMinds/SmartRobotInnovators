<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GlowBit Project 3 ‚Äì Liam‚Äôs SOS Blinker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Blockly + Glowbit core -->
  <script src="lib/blockly_compressed.js"></script>
  <script src="lib/blocks_compressed.js"></script>
  <script src="lib/javascript_compressed.js"></script>
  <script src="lib/msg/en.js"></script>
  <script src="assets/global.js"></script>
  <script src="lib/blockly_xml_patch.js"></script>

  <style>
    .gb-wrapper{max-width:1100px;margin:0 auto;font-family:"Segoe UI",Roboto,Arial,sans-serif;}
    .gb-header {
      text-align:center;
      background:#e6f9ff;
      color:#00A1D6;
      font-size:22px;
      font-weight:800;
      padding:6px 10px;
      border:3px solid #7dd3fc;
      border-radius:8px;
      margin-bottom:8px;
      box-shadow:0 1px 4px rgba(0,0,0,0.08);
    }
    .gb-header .highlight { color:#991b1b; }
    .gb-intro {
  text-align:center;
  font-size:18px;
  line-height:1.5;
  margin:0 0 12px;
  color:#1e3a8a;
  background:#e0f2fe;
  border:1px solid #7dd3fc;
  border-radius:10px;
  padding:10px 14px;
  font-weight:600;
}
    .didyouknow{margin-top:18px;background:#fef9c3;border:2px solid #facc15;padding:10px 12px;
                border-radius:12px;color:#713f12;font-size:15px;font-weight:600;position:relative;
                box-shadow:0 2px 5px rgba(0,0,0,0.06);}
    .didyouknow::before{content:"";position:absolute;top:-10px;left:20px;border-width:0 10px 10px 10px;
                         border-style:solid;border-color:transparent transparent #fef9c3 transparent;}
    .didyouknow p{text-align:justify;margin:6px 0;}
    .nav-btns{display:flex;justify-content:space-between;gap:8px;margin-top:10px;flex-wrap:wrap;}
    .gb-btn{padding:8px 14px;border:none;border-radius:6px;font-weight:700;cursor:pointer;flex:1;text-align:center;}
    .gb-btn.next{background:#00A1D6;color:#fff;}
    .gb-btn.back{background:#6B7280;color:#fff;}
    .gb-btn.check{background:#10B981;color:#fff;display:block;margin:12px auto 0;}
    #solutionModalP3{display:none;position:fixed;top:60px;right:20px;width:640px;max-width:42%;
                     background:#fff;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,0.28);
                     z-index:12000;overflow:hidden;user-select:none;}
    #solutionHeaderP3{cursor:move;padding:10px 12px;background:#00A1D6;color:#fff;font-weight:700;
                      text-align:left;border-radius:10px 10px 0 0;display:flex;justify-content:space-between;align-items:center;}
    #solutionWorkspaceP3{height:360px;width:100%;border-top:1px solid #eee;background:#fafafa;}
    #solutionFooterP3{text-align:center;padding:12px;background:#fff;}
    #solutionFooterP3 button{background:#00A1D6;color:#fff;border:none;border-radius:8px;
                              padding:8px 18px;cursor:pointer;font-weight:700;}
    @media(max-width:900px){
      #solutionModalP3{left:10px;right:10px;width:auto;max-width:calc(100% - 20px);top:40px;}
      #solutionWorkspaceP3{height:260px;}
    }
    .character-frame{text-align:center;margin-top:18px;}
    .character-frame img{width:85%;max-width:260px;height:auto;border-radius:12px;
                         box-shadow:0 4px 12px rgba(0,0,0,0.25);object-fit:cover;}
    .character-name{margin-top:8px;font-weight:700;color:#374151;font-size:15px;}
  </style>
</head>

<body>
  <div class="gb-wrapper">
    <div class="gb-header">
      üåü <span class="highlight">Project 3</span>: Liam‚Äôs GlowBit SOS Blinker ‚Äî 
      <span class="highlight">Let‚Äôs make GlowBit flash an SOS signal to save the day!</span>
    </div>

    <p class="gb-intro">
      You‚Äôll code GlowBit to blink the Morse code pattern for SOS (three short flashes, three long flashes, three short flashes). Follow the steps on the right.
    </p>

    <div id="glowbit-project3-step1"></div>
  </div>

  <!-- Solution Modal -->
  <div id="solutionModalP3" aria-hidden="true" role="dialog">
    <div id="solutionHeaderP3">
      <div>‚úÖ Correct Setup ‚Äî GlowBit SOS Blinker</div>
      <button id="solutionCloseP3" title="Close">‚úï</button>
    </div>
    <div id="solutionWorkspaceP3" aria-label="Correct solution workspace"></div>
    <div id="solutionFooterP3"><button id="solutionCloseBtnP3">Close</button></div>
  </div>

  <script>
  (function waitForGlow(){
    if(!(window.Glowbit && window.Blockly)) return setTimeout(waitForGlow,120);

    /* --- Helper functions to build block JSON safely --- */
    function makePlot(x,y,next=null){const b={type:"plot",fields:{X:x,Y:y}};if(next)b.next={block:next};return b;}
    function makePlotRow(next=null){
      const coords=[[1,4],[2,4],[3,4],[4,4],[5,4],[6,4]];let chain=next;
      for(let i=coords.length-1;i>=0;i--){chain=makePlot(coords[i][0],coords[i][1],chain);}return chain;
    }
    function makeFlash(ms){
  const after = { type: "pause_block", fields: { MS: ms } };
  const clear = { type: "clear_screen", next: { block: after } };
  const before = { type: "pause_block", fields: { MS: ms }, next: { block: clear } };
  return makePlotRow(before);
}
    function repeat(times,body,next=null){
      return{type:"controls_repeat_ext",
        inputs:{TIMES:{block:{type:"math_number",fields:{NUM:times}}},DO:{block:body}},
        next:next?{block:next}:undefined};
    }

    /* --- Build short (200 ms), long (600 ms), short (200 ms) pattern --- */
    const shortFlash=repeat(3,makeFlash(200));
    const longFlash=repeat(3,makeFlash(600),repeat(3,makeFlash(200)));
    shortFlash.next={block:longFlash};

    const solutionJson={
      blocks:{
        languageVersion:0,
        blocks:[
          {type:"on_button_pressed",fields:{BTN:"A"},x:20,y:20,inputs:{DO:{block:shortFlash}}}
        ]
      }
    };

    /* --- Lesson UI setup (same as Project 1 & 2) --- */
    const lesson=Glowbit.createLessonUI('glowbit-project3-step1',{title:'',instructions:'',pixelSize:28,defaultJson:null});
    if(lesson&&lesson.workspace)lesson.workspace.clear();

    /* --- Sidebar content --- */
    const stepCards=[
`<h3 style="text-align:center;color:#00A1D6;">Step 1: Set Up Your SOS Signal Pattern</h3>
 <div style="margin:10px 0;padding:10px;border-radius:8px;background:#0284C7;color:#fff;">
 ‚Ä¢ From the <strong>LED</strong> tab, drag six <strong>Plot (x,y)</strong> blocks.<br>
 ‚Ä¢ Use centered coords: <code>(1,4)(2,4)(3,4)(4,4)(5,4)(6,4)</code>.<br>
 ‚Ä¢ Add <strong>on start</strong> (Basic tab) and a <strong>Clear Screen</strong> inside it.<br>
 ‚Ä¢ Place your six Plot blocks inside to test the row.<br>
 ‚Ä¢ Click <strong>Run</strong> to light the row. </div>`,

`<h3 style="text-align:center;color:#00A1D6;">Step 2: Code a Short Flash with Button A</h3>
 <div style="margin:10px 0;padding:10px;border-radius:8px;background:#7B2CBF;color:#fff;">
 ‚Ä¢ Drag <strong>on button A pressed</strong> from <strong>Input</strong>.<br>
 ‚Ä¢ Inside it:<br>
 &nbsp;&nbsp;‚ûï Add your six Plot blocks.<br>
 &nbsp;&nbsp;üïí Add <strong>pause (200 ms)</strong>.<br>
 &nbsp;&nbsp;üßº Add <strong>clear screen</strong>.<br>
 &nbsp;&nbsp;üïí Add another <strong>pause (200 ms)</strong>.<br>
 ‚Ä¢ Press Run then Button A ‚Üí watch the short flash! Liam says, ‚ÄúQuick and cool!‚Äù</div>`,

`<h3 style="text-align:center;color:#00A1D6;">Step 3: Build the Full SOS Pattern</h3>
 <div style="margin:10px 0;padding:10px;border-radius:8px;background:#00A1D6;color:#fff;">
 ‚Ä¢ Use <strong>repeat 3 times</strong> and place your blocks from Step2 inside it to make three short flashes (S).<br>
 ‚Ä¢ Duplicate the whole setup ‚Üí set pauses to <strong>600 ms</strong> for long flashes (O).<br>
 ‚Ä¢ Duplicate again and set <strong>pause (200 ms)</strong> for the final S.<br>
 ‚Ä¢ Click <strong>Run</strong> and press A to send SOS! Liam shouts, ‚ÄúGlowBit‚Äôs saving the day!‚Äù</div>`,

`<button id="check-setup-btnP3" class="gb-btn check">‚úÖ Check Your Setup</button>
 <div class="didyouknow">
   üí° <strong>Did you know?</strong>
   <p>üî¶ <strong>Morse code</strong> is still used by ships and aircraft for emergencies ‚Äî SOS means ‚ÄúSave Our Ship‚Äù.</p>
   <p>üõ∞Ô∏è Astronauts train to recognize light-flash patterns for silent communication in space.</p>
   <p>üí° Devices like routers and drones blink LEDs in coded sequences to report status ‚Äî just like GlowBit!</p>
 </div>`
    ];

    /* --- Sidebar auto-pagination --- */
    function paginate(){
      const sidebar=document.querySelector('#glowbit-project3-step1 .glowbit-left');
      if(!sidebar)return;
      const editor=document.getElementById('glowbit-project3-step1-editor');
      const targetH=(editor&&editor.offsetHeight)?editor.offsetHeight:520;
      const meas=document.createElement('div');
      meas.style.visibility='hidden';meas.style.position='absolute';meas.style.left='-9999px';meas.style.top='-9999px';
      meas.style.width=(sidebar.clientWidth||320)+'px';document.body.appendChild(meas);
      const pages=[];let current=[];const reserve=56;
      stepCards.forEach(html=>{
        const c=document.createElement('div');c.innerHTML=html;meas.appendChild(c);
        const tooTall=meas.scrollHeight>(targetH-reserve);
        if(tooTall){
          if(current.length===0){pages.push([html]);meas.innerHTML='';}
          else{pages.push([...current]);current=[html];meas.innerHTML='';
            current.forEach(h=>{const d=document.createElement('div');d.innerHTML=h;meas.appendChild(d);});}
        }else current.push(html);
      });
      if(current.length)pages.push(current);
      document.body.removeChild(meas);
      function render(i){
        sidebar.innerHTML=pages[i].join('');
        const nav=document.createElement('div');nav.className='nav-btns';
        if(i>0){const b=document.createElement('button');b.textContent='‚¨Ö Back';b.className='gb-btn back';b.onclick=()=>render(i-1);nav.appendChild(b);}
        if(i<pages.length-1){const n=document.createElement('button');n.textContent='Next ‚ûú';n.className='gb-btn next';n.onclick=()=>render(i+1);nav.appendChild(n);}
        sidebar.appendChild(nav);
        const frame=document.createElement('div');frame.className='character-frame';
        frame.innerHTML=`<img src="images/P3.png" alt="Liam the Coder">`;sidebar.appendChild(frame);
      }
      render(0);
    }
    paginate();let _rt=null;
    window.addEventListener('resize',()=>{clearTimeout(_rt);_rt=setTimeout(paginate,150);});

    /* --- Modal logic --- */
    const modal=document.getElementById('solutionModalP3');
    /* --- Make the modal draggable --- */
function makeDraggable(modalId, headerId){
  const modalEl = document.getElementById(modalId);
  const headerEl = document.getElementById(headerId);
  if(!modalEl || !headerEl) return;

  let isDown = false, startX = 0, startY = 0;

  headerEl.style.cursor = 'move';
  headerEl.addEventListener('mousedown', (e)=>{
    isDown = true;
    startX = e.clientX - modalEl.offsetLeft;
    startY = e.clientY - modalEl.offsetTop;
    document.addEventListener('mousemove', move);
    document.addEventListener('mouseup', stop);
  });

  function move(e){
    if(!isDown) return;
    modalEl.style.left = (e.clientX - startX) + 'px';
    modalEl.style.top = (e.clientY - startY) + 'px';
    modalEl.style.right = 'auto';
  }

  function stop(){
    isDown = false;
    document.removeEventListener('mousemove', move);
    document.removeEventListener('mouseup', stop);
  }
}

/* ‚úÖ Enable drag on Project 3 modal */
makeDraggable('solutionModalP3','solutionModalP3');

    document.addEventListener('click',function(e){
      if(e.target&&e.target.id==='check-setup-btnP3'){
        modal.style.display='block';
        modal.setAttribute('aria-hidden','false');
        if(!window._solutionWorkspaceP3){
          const ws=document.getElementById('solutionWorkspaceP3');
          window._solutionWorkspaceP3=Blockly.inject(ws,{readOnly:true,scrollbars:true,toolbox:null});
          Blockly.serialization.workspaces.load(solutionJson,window._solutionWorkspaceP3);
        }
      }
      if(e.target&&(e.target.id==='solutionCloseP3'||e.target.id==='solutionCloseBtnP3')){
        modal.style.display='none';modal.setAttribute('aria-hidden','true');
      }
    });

    console.log('‚úÖ Project 3 ‚Äì SOS Blinker ready.');
  })();
  </script>
</body>
</html>

