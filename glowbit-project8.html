<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GlowBit Project 8 ‚Äì Mia‚Äôs GlowBit Sound Alert</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Blockly + Glowbit core -->
  <script src="lib/blockly_compressed.js"></script>
  <script src="lib/blocks_compressed.js"></script>
  <script src="lib/javascript_compressed.js"></script>
  <script src="lib/msg/en.js"></script>
  <script src="assets/global.js"></script>
  <script src="lib/blockly_xml_patch.js"></script>

  <style>
    .gb-wrapper{max-width:1100px;margin:0 auto;font-family:"Segoe UI",Roboto,Arial,sans-serif;}
    .gb-header{text-align:center;background:#e6f9ff;color:#00A1D6;font-size:22px;font-weight:800;
                padding:6px 10px;border-radius:8px;margin-bottom:8px;box-shadow:0 1px 4px rgba(0,0,0,0.08);}
    .gb-header .highlight{color:#7B2CBF;}
    .gb-intro{text-align:center;font-size:16px;line-height:1.5;margin:0 0 10px;color:#374151;
               background:#e0f2fe;border-radius:6px;padding:10px 12px;box-shadow:0 1px 3px rgba(0,0,0,0.06);}
    .didyouknow{margin-top:18px;background:#fef9c3;border:2px solid #facc15;padding:10px 12px;
                border-radius:12px;color:#713f12;font-size:15px;font-weight:600;position:relative;
                box-shadow:0 2px 5px rgba(0,0,0,0.06);}
    .didyouknow::before{content:"";position:absolute;top:-10px;left:20px;border-width:0 10px 10px 10px;
                         border-style:solid;border-color:transparent transparent #fef9c3 transparent;}
    .didyouknow p{text-align:justify;margin:6px 0;}
    .nav-btns{display:flex;justify-content:space-between;gap:8px;margin-top:10px;flex-wrap:wrap;}
    .gb-btn{padding:8px 14px;border:none;border-radius:6px;font-weight:700;cursor:pointer;flex:1;text-align:center;}
    .gb-btn.next{background:#00A1D6;color:#fff;}
    .gb-btn.back{background:#6B7280;color:#fff;}
    .gb-btn.check{background:#10B981;color:#fff;display:block;margin:12px auto 0;}
    #solutionModalP8{display:none;position:fixed;top:60px;right:20px;width:640px;max-width:42%;
                     background:#fff;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,0.28);
                     z-index:12000;overflow:hidden;user-select:none;}
    #solutionHeaderP8{cursor:move;padding:10px 12px;background:#00A1D6;color:#fff;font-weight:700;
                      text-align:left;border-radius:10px 10px 0 0;display:flex;justify-content:space-between;align-items:center;}
    #solutionWorkspaceP8{height:360px;width:100%;border-top:1px solid #eee;background:#fafafa;}
    #solutionFooterP8{text-align:center;padding:12px;background:#fff;}
    #solutionFooterP8 button{background:#00A1D6;color:#fff;border:none;border-radius:8px;
                              padding:8px 18px;cursor:pointer;font-weight:700;}
    @media(max-width:900px){
      #solutionModalP8{left:10px;right:10px;width:auto;max-width:calc(100% - 20px);top:40px;}
      #solutionWorkspaceP8{height:260px;}
    }
    .character-frame{text-align:center;margin-top:18px;}
    .character-frame img{width:85%;max-width:260px;height:auto;border-radius:12px;
                         box-shadow:0 4px 12px rgba(0,0,0,0.25);object-fit:cover;}
  </style>
</head>

<body>
  <div class="gb-wrapper">
    <div class="gb-header">
      üîä <span class="highlight">Mia‚Äôs GlowBit Sound Alert</span> ‚Äî
      <span class="highlight">Bright vs. dim flashes based on sound level!</span>
    </div>

    <p class="gb-intro">
      You‚Äôll code GlowBit to check the <strong>sound level</strong> and show a <strong>bright</strong> flash when it‚Äôs loud, or a <strong>dim</strong> flash when it‚Äôs quiet‚Äîjust like a robot reacting to noise.
    </p>

    <div id="glowbit-project8-step1"></div>
  </div>

  <!-- Solution Modal -->
  <div id="solutionModalP8" aria-hidden="true" role="dialog">
    <div id="solutionHeaderP8">
      <div>‚úÖ Correct Setup ‚Äî Sound Alert</div>
      <button id="solutionCloseP8" title="Close">‚úï</button>
    </div>
    <div id="solutionWorkspaceP8" aria-label="Correct solution workspace"></div>
    <div id="solutionFooterP8"><button id="solutionCloseBtnP8">Close</button></div>
  </div>

  <script>
  (function waitForGlow(){
    if(!(window.Glowbit && window.Blockly)) return setTimeout(waitForGlow,120);

    /* --- Correct Answer JSON ---
       forever:
         if (sound_level > 120)
           set_brightness 255
           show_icon "square"   // full grid bright
         else
           set_brightness 50
           show_icon "square"   // full grid dim
           clear_screen
         pause 500
    */
   const solutionJson = {
  blocks: {
    languageVersion: 0,
    blocks: [
      {
        type: "forever",
        x: 20, y: 20,
        inputs: {
          DO: {
            block: {
              type: "controls_if",
              inputs: {
                IF0: {
                  block: {
                    type: "logic_compare",
                    fields: { OP: "GT" },
                    inputs: {
                      A: { block: { type: "sound_level" } },
                      B: { block: { type: "math_number", fields: { NUM: 120 } } }
                    }
                  }
                },
                DO0: {
                  block: {
                    type: "set_brightness",
                    inputs: {
                      VALUE: { shadow: { type: "math_number", fields: { NUM: 255 } } }
                    },
                    next: {
                      block: { type: "show_icon", fields: { ICON: "square" } }
                    }
                  }
                },
                ELSE: {
                  block: {
                    type: "set_brightness",
                    inputs: {
                      VALUE: { shadow: { type: "math_number", fields: { NUM: 50 } } }
                    },
                    next: {
                      block: {
                        type: "show_icon",
                        fields: { ICON: "square" },
                        next: { block: { type: "clear_screen" } }
                      }
                    }
                  }
                }
              },
              next: { block: { type: "pause_block", fields: { MS: 500 } } }
            }
          }
        }
      }
    ]
  }
};
    /* --- Lesson UI setup --- */
    const lesson = Glowbit.createLessonUI('glowbit-project8-step1',{title:'',instructions:'',pixelSize:28,defaultJson:null});
    if(lesson && lesson.workspace) lesson.workspace.clear();

   /* --- Sidebar content (expanded logic steps with mutator + compare, with inline SVG hints) --- */
const stepCards = [
`<h3 style="text-align:center;color:#00A1D6;">Step 1: Set Up a Bright Flash</h3>
 <div style="margin:10px 0;padding:10px;border-radius:8px;background:#0284C7;color:#fff;">
 ‚Ä¢ From <strong>LED</strong>, drag <strong>set brightness</strong> and set it to <code>255</code> (maximum).<br>
 ‚Ä¢ From <strong>Icon</strong>, drag <strong>show icon</strong> and choose <strong>square</strong> (full grid).<br>
 ‚Ä¢ Test inside <strong>on start</strong>: add <strong>Clear Screen</strong>, then <strong>set brightness 255</strong> ‚Üí <strong>show icon square</strong>.<br>
 ‚Ä¢ Click <strong>Run</strong> ‚Äî GlowBit shines super bright!<br>
 üí¨ Mia: ‚ÄúGlowBit‚Äôs shining super bright!‚Äù<br><br>
 üß© After testing, remove these from <strong>on start</strong> so we can use them in logic.</div>`,

`<h3 style="text-align:center;color:#00A1D6;">Step 2: Add a Dim Flash</h3>
 <div style="margin:10px 0;padding:10px;border-radius:8px;background:#7B2CBF;color:#fff;">
 ‚Ä¢ From <strong>LED</strong>, add another <strong>set brightness</strong> and set it to <code>50</code> (low).<br>
 ‚Ä¢ Reuse <strong>show icon ‚Üí square</strong> to light the whole grid dimly.<br>
 ‚Ä¢ Test quickly in <strong>on start</strong> (after <strong>Clear Screen</strong>) then remove ‚Äî we‚Äôll place these in the <em>else</em> later.</div>`,

`<h3 style="text-align:center;color:#00A1D6;">Step 3: Check the Sound Level</h3>
 <div style="margin:10px 0;padding:10px;border-radius:8px;background:#00A1D6;color:#fff;">
 ‚Ä¢ From <strong>Input</strong>, drag <strong>sound level</strong> (0‚Äì255).<br>
 ‚Ä¢ To see its value, put it inside <strong>show number</strong> (Basic) and run once.<br>
 ‚Ä¢ Use the <strong>Sound Level</strong> slider under the canvas to raise/lower the value.<br>
 ‚Ä¢ Remove the test blocks ‚Äî next we‚Äôll use this reporter in a comparison.</div>`,

`<h3 style="text-align:center;color:#00A1D6;">Step 4A: Create the Forever Loop</h3>
 <div style="margin:10px 0;padding:10px;border-radius:8px;background:#10B981;color:#0f5132;">
 ‚Ä¢ From <strong>Basic</strong>, drag a <strong>forever</strong> loop to the Workspace.<br>
 ‚Ä¢ We will place our decision logic <em>inside</em> this loop so GlowBit keeps checking sound.</div>`,

`<h3 style="text-align:center;color:#00A1D6;">Step 4B: Build an If‚ÄìThen‚ÄìElse (with the Wheel)
  <span aria-hidden="true" style="vertical-align:middle;display:inline-block;margin-left:6px;">
    <!-- tiny gear icon -->
    <svg width="14" height="14" viewBox="0 0 24 24" fill="#fff" style="vertical-align:-2px;">
      <path d="M19.14,12.94c.04-.31,.06-.63,.06-.94s-.02-.63-.06-.94l2.03-1.58c.18-.14,.23-.4,.12-.61l-1.92-3.32c-.11-.21-.36-.3-.58-.22l-2.39,.96c-.5-.38-1.03-.69-1.62-.92l-.36-2.54c-.04-.23-.23-.4-.47-.4h-3.84c-.24,0-.43,.17-.47,.4l-.36,2.54c-.59,.23-1.12,.54-1.62,.92l-2.39-.96c-.22-.09-.47,0-.58,.22l-1.92,3.32c-.11,.21-.06,.47,.12,.61l2.03,1.58c-.04,.31-.06,.63-.06,.94s.02,.63,.06,.94l-2.03,1.58c-.18,.14-.23,.4-.12,.61l1.92,3.32c.11,.21,.36,.3,.58,.22l2.39-.96c.5,.38,1.03,.69,1.62,.92l.36,2.54c.04,.23,.23,.4,.47,.4h3.84c.24,0,.43-.17,.47-.4l.36-2.54c.59-.23,1.12-.54,1.62-.92l2.39,.96c.22,.09,.47,0,.58-.22l1.92-3.32c.11-.21,.06-.47-.12-.61l-2.03-1.58ZM12,15.5c-1.93,0-3.5-1.57-3.5-3.5s1.57-3.5,3.5-3.5,3.5,1.57,3.5,3.5-1.57,3.5-3.5,3.5Z"/>
    </svg>
  </span>
</h3>
 <div style="margin:10px 0;padding:10px;border-radius:8px;background:#10B981;color:#0f5132;">
 ‚Ä¢ From <strong>Logic</strong>, drag an <strong>if</strong> block into the <strong>forever</strong> loop.<br>
 ‚Ä¢ Click the tiny gear 
   <span aria-hidden="true" style="display:inline-block;vertical-align:middle;">
     <svg width="14" height="14" viewBox="0 0 24 24" fill="#0f5132" style="vertical-align:-2px;">
       <path d="M19.14,12.94c.04-.31,.06-.63,.06-.94s-.02-.63-.06-.94l2.03-1.58c.18-.14,.23-.4,.12-.61l-1.92-3.32c-.11-.21-.36-.3-.58-.22l-2.39,.96c-.5-.38-1.03-.69-1.62-.92l-.36-2.54c-.04-.23-.23-.4-.47-.4h-3.84c-.24,0-.43,.17-.47,.4l-.36,2.54c-.59,.23-1.12,.54-1.62,.92l-2.39-.96c-.22-.09-.47,0-.58,.22l-1.92,3.32c-.11,.21-.06,.47,.12,.61l2.03,1.58c-.04,.31-.06,.63-.06,.94s.02,.63,.06,.94l-2.03,1.58c-.18,.14-.23,.4-.12,.61l1.92,3.32c.11,.21,.36,.3,.58,.22l2.39-.96c.5,.38,1.03,.69,1.62,.92l.36,2.54c.04,.23,.23,.4,.47,.4h3.84c.24,0,.43-.17,.47-.4l.36-2.54c.59-.23,1.12-.54,1.62-.92l2.39,.96c.22,.09,.47,0,.58-.22l1.92-3.32c.11-.21,.06-.47-.12-.61l-2.03-1.58ZM12,15.5c-1.93,0-3.5-1.57-3.5-3.5s1.57-3.5,3.5-3.5,3.5,1.57,3.5,3.5-1.57,3.5-3.5,3.5Z"/>
     </svg>
   </span> on the if block to open the <strong>mutator</strong> panel.<br>
 ‚Ä¢ In the mutator:<br>
 &nbsp;&nbsp;‚Äî Drag an <strong>else</strong> piece into the structure so it reads <em>if ‚Ä¶ do ‚Ä¶ else ‚Ä¶</em>.<br>
 &nbsp;&nbsp;‚Äî Close the mutator. You now have a full <strong>if‚Äìthen‚Äìelse</strong> block.</div>`,

`<h3 style="text-align:center;color:#00A1D6;">Step 4C: Build the Comparison (sound &gt; 120)
  <span aria-hidden="true" style="vertical-align:middle;display:inline-block;margin-left:6px;">
    <!-- tiny compare glyph -->
    <svg width="46" height="16" viewBox="0 0 92 32" style="vertical-align:-3px">
      <rect x="1" y="1" width="90" height="30" rx="4" ry="4" fill="#e2e8f0" stroke="#94a3b8"></rect>
      <text x="12" y="21" font-family="monospace" font-size="14" fill="#334155">A &gt; B ‚ñæ</text>
    </svg>
  </span>
</h3>
 <div style="margin:10px 0;padding:10px;border-radius:8px;background:#10B981;color:#0f5132;">
 ‚Ä¢ From <strong>Logic</strong>, drag a <strong>compare</strong> block (looks like <code>A = B</code>) and drop it into the <strong>if</strong> slot.<br>
 ‚Ä¢ Click the operator dropdown 
   <span aria-hidden="true" style="display:inline-block;vertical-align:-2px;">
     <svg width="16" height="16" viewBox="0 0 24 24">
       <path fill="#0f5132" d="M7 10l5-5 5 5H7zM7 14l5 5 5-5H7z"/>
     </svg>
   </span>
   and change it to <strong>&gt;</strong> (greater than).<br>
 ‚Ä¢ In the left input (A), place the <strong>sound level</strong> block from <strong>Input</strong>.<br>
 ‚Ä¢ In the right input (B), place <strong>math number</strong> (from <strong>Math</strong>) and set it to <code>120</code>.<br>
 ‚Ä¢ Your condition should read: <strong>sound level &gt; 120</strong>.</div>`,

`<h3 style="text-align:center;color:#00A1D6;">Step 4D: Fill the Then / Else Parts</h3>
 <div style="margin:10px 0;padding:10px;border-radius:8px;background:#10B981;color:#0f5132;">
 ‚Ä¢ In the <strong>then</strong> area (loud):<br>
 &nbsp;&nbsp;‚ë† <strong>set brightness 255</strong> ‚Üí ‚ë° <strong>show icon square</strong>.<br>
 ‚Ä¢ In the <strong>else</strong> area (quiet):<br>
 &nbsp;&nbsp;‚ë† <strong>set brightness 50</strong> ‚Üí ‚ë° <strong>show icon square</strong> ‚Üí ‚ë¢ <strong>clear screen</strong>.<br>
 ‚Ä¢ After the if‚Äìelse (still inside <strong>forever</strong>): add <strong>pause 500 ms</strong> so changes are readable.</div>`,

`<h3 style="text-align:center;color:#00A1D6;">Step 5: Run &amp; Tune</h3>
 <div style="margin:10px 0;padding:10px;border-radius:8px;background:#e0f2fe;color:#0f172a;">
 ‚Ä¢ Click <strong>Run</strong>. Use the <strong>Sound Level</strong> slider below the canvas.<br>
 ‚Ä¢ Above <code>120</code> &rarr; bright flash. Below <code>120</code> &rarr; dim flash.<br>
 ‚Ä¢ Try variations:<br>
 &nbsp;&nbsp;‚Äî Brightness pairs like <code>200</code>/<code>20</code>.<br>
 &nbsp;&nbsp;‚Äî Thresholds like <code>80</code> (more sensitive) or <code>150</code> (less).<br>
 &nbsp;&nbsp;‚Äî Add a quick <strong>play tone</strong> in the <em>then</em> part for a sound alert.</div>`,

`<button id="check-setup-btnP8" class="gb-btn check">‚úÖ Check Your Setup</button>
 <div class="didyouknow">
   üí° <strong>Did you know?</strong>
   <p>üö® Noise monitors in classrooms and libraries use thresholds to flash lights when it‚Äôs too loud‚Äîexactly like your if‚Äìthen‚Äìelse!</p>
   <p>üè≠ Factory ‚Äúandon‚Äù towers change brightness/color to warn operators; engineers pick thresholds just like your 120.</p>
   <p>üß† Conditional logic is how computers make decisions: ‚Äúif this, then do that, else do something different.‚Äù</p>
   <p>üéõÔ∏è Brightness and timing control (pauses) make alerts readable and less distracting‚Äîan important UX skill.</p>
 </div>`
];

    /* --- Sidebar auto-pagination --- */
    function paginate(){
      const sidebar=document.querySelector('#glowbit-project8-step1 .glowbit-left');
      if(!sidebar)return;
      const editor=document.getElementById('glowbit-project8-step1-editor');
      const targetH=(editor&&editor.offsetHeight)?editor.offsetHeight:520;
      const meas=document.createElement('div');
      meas.style.visibility='hidden';meas.style.position='absolute';meas.style.left='-9999px';meas.style.top='-9999px';
      meas.style.width=(sidebar.clientWidth||320)+'px';document.body.appendChild(meas);
      const pages=[];let current=[];const reserve=56;
      stepCards.forEach(html=>{
        const c=document.createElement('div');c.innerHTML=html;meas.appendChild(c);
        const tooTall=meas.scrollHeight>(targetH-reserve);
        if(tooTall){
          if(current.length===0){pages.push([html]);meas.innerHTML='';}
          else{pages.push([...current]);current=[html];meas.innerHTML='';
            current.forEach(h=>{const d=document.createElement('div');d.innerHTML=h;meas.appendChild(d);});}
        }else current.push(html);
      });
      if(current.length)pages.push(current);
      document.body.removeChild(meas);
      function render(i){
        sidebar.innerHTML=pages[i].join('');
        const nav=document.createElement('div');nav.className='nav-btns';
        if(i>0){const b=document.createElement('button');b.textContent='‚¨Ö Back';b.className='gb-btn back';b.onclick=()=>render(i-1);nav.appendChild(b);}
        if(i<pages.length-1){const n=document.createElement('button');n.textContent='Next ‚ûú';n.className='gb-btn next';n.onclick=()=>render(i+1);nav.appendChild(n);}
        sidebar.appendChild(nav);
        const frame=document.createElement('div');frame.className='character-frame';
        frame.innerHTML='<img src="images/Mia3.png" alt="Mia the Maker">';sidebar.appendChild(frame);
      }
      render(0);
    }
    paginate();let _rt=null;
    window.addEventListener('resize',()=>{clearTimeout(_rt);_rt=setTimeout(paginate,150);});

    /* --- Modal logic --- */
    const modal=document.getElementById('solutionModalP8');
    document.addEventListener('click',function(e){
      if(e.target&&e.target.id==='check-setup-btnP8'){
        modal.style.display='block';
        modal.setAttribute('aria-hidden','false');
        if(!window._solutionWorkspaceP8){
          const ws=document.getElementById('solutionWorkspaceP8');
          window._solutionWorkspaceP8=Blockly.inject(ws,{readOnly:true,scrollbars:true,toolbox:null});
          Blockly.serialization.workspaces.load(solutionJson,window._solutionWorkspaceP8);
        }
      }
      if(e.target&&(e.target.id==='solutionCloseP8'||e.target.id==='solutionCloseBtnP8')){
        modal.style.display='none';modal.setAttribute('aria-hidden','true');
      }
    });

    console.log('‚úÖ Project 8 ‚Äì Sound Alert ready.');
  })();
  </script>
</body>
</html>
