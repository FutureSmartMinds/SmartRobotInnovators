<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>(9) Liam’s GlowBit Tilt Navigator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Required script order -->
  <script src="lib/blockly_compressed.js"></script>
  <script src="lib/blocks_compressed.js"></script>
  <script src="lib/javascript_compressed.js"></script>
  <script src="lib/msg/en.js"></script>
  <script src="assets/global.js"></script>
  <script src="lib/blockly_xml_patch.js"></script>

  <style>
    .gb-wrapper{max-width:1100px;margin:0 auto;font-family:"Segoe UI",Roboto,Arial,sans-serif;}
    .gb-header{text-align:center;background:#eef2ff;color:#3730a3;font-size:22px;font-weight:800;
               padding:10px 12px;border-radius:12px;margin:8px 0 6px;box-shadow:0 1px 4px rgba(0,0,0,0.08);}
    .gb-subhead{text-align:center;background:#ecfeff;color:#0e7490;font-size:16px;font-weight:800;
                padding:8px 12px;border-radius:10px;margin:0 0 10px;box-shadow:0 1px 3px rgba(0,0,0,0.06);}
    .callout{background:#f1f5f9;border-left:6px solid #64748b;padding:8px 10px;border-radius:8px;color:#0f172a;margin:8px 0;}
    .tip{display:inline-block;background:#fde68a;color:#92400e;border:1px solid #f59e0b;border-radius:6px;
         padding:2px 6px;font-size:12px;font-weight:800;}
    .nav-btns{display:flex;justify-content:space-between;gap:8px;margin-top:10px;flex-wrap:wrap;}
    .gb-btn{padding:8px 14px;border:none;border-radius:6px;font-weight:700;cursor:pointer;flex:1;text-align:center;}
    .gb-btn.next{background:#00A1D6;color:#fff;}
    .gb-btn.back{background:#6B7280;color:#fff;}
    .gb-btn.check{background:#10B981;color:#fff;display:block;margin:14px auto 0;}
    .character-frame{text-align:center;margin-top:18px;}
    .character-frame img{width:85%;max-width:260px;height:auto;border-radius:12px;
                         box-shadow:0 4px 12px rgba(0,0,0,0.25);object-fit:cover;}
    #glowbit-project9-editor{height:560px;min-height:560px;background:#fff;}
  </style>
</head>

<body>
<div class="gb-wrapper">
  <div class="gb-header">(9) Liam’s GlowBit Tilt Navigator</div>
  <div class="gb-subhead">Make GlowBit point arrows when you shake it!</div>
  <div id="glowbit-project9"></div>
</div>

<!-- ✅ Compact Solution Modal (same pattern as Project 8) -->
<div id="solutionModalP9" aria-hidden="true" role="dialog" 
     style="display:none;position:fixed;top:60px;right:20px;width:640px;max-width:42%;
            background:#fff;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,0.28);
            z-index:12000;overflow:hidden;user-select:none;">
  <div id="solutionHeaderP9"
       style="cursor:move;padding:10px 12px;background:#00A1D6;color:#fff;font-weight:700;
              text-align:left;border-radius:10px 10px 0 0;display:flex;
              justify-content:space-between;align-items:center;">
    <div>✅ Correct Setup — Tilt Navigator</div>
    <button id="solutionCloseP9" title="Close">✕</button>
  </div>
  <div id="solutionWorkspaceP9" style="height:360px;width:100%;border-top:1px solid #eee;background:#fafafa;"></div>
  <div id="solutionFooterP9" style="text-align:center;padding:12px;background:#fff;">
    <button id="solutionCloseBtnP9">Close</button>
  </div>
</div>

<script>
(function boot(){
  if(!(window.Glowbit && window.Blockly)) return setTimeout(boot,120);

  /* --- Lesson UI setup --- */
  const lesson = Glowbit.createLessonUI('glowbit-project9',{
    title:'',instructions:'',pixelSize:28,
    defaultJson:{blocks:{languageVersion:0,blocks:[]}}
  });
  if(lesson && lesson.workspace) lesson.workspace.clear();

  /* --- Helper: Pause→Show→Clear sequence --- */
  function seqPauseShowClear(dir){
    return {
      type:"pause_block",fields:{MS:500},
      next:{block:{type:"show_arrow",fields:{ARROW:dir},
      next:{block:{type:"clear_screen"}}}}
    };
  }

  /* --- Correct Answer JSON (for modal) --- */
  const solutionJson = {
    blocks:{languageVersion:0,blocks:[
      {type:"on_start",x:18,y:18,inputs:{DO:{block:seqPauseShowClear("arrow_right")}}},
      {type:"on_button_pressed",x:18,y:180,fields:{BTN:"A"},inputs:{DO:{block:seqPauseShowClear("arrow_up")}}},
      {type:"on_button_pressed",x:18,y:340,fields:{BTN:"B"},inputs:{DO:{block:seqPauseShowClear("arrow_down")}}},
      {type:"on_shake",x:18,y:500,inputs:{DO:{block:seqPauseShowClear("arrow_left")}}}
    ]}
  };
  window.solutionJson = solutionJson;

  /* --- Starter block on workspace --- */
  if(lesson && lesson.workspace){
    const starter={blocks:{languageVersion:0,blocks:[
      {type:"on_button_pressed",x:20,y:20,fields:{BTN:"A"},
       inputs:{DO:{block:seqPauseShowClear("arrow_up")}}}
    ]}};
    Blockly.serialization.workspaces.load(starter,lesson.workspace);
    setTimeout(()=>Blockly.svgResize(lesson.workspace),0);
  }

  /* --- Sidebar content with Check button --- */
  const stepCards=[
  `<h3 style="text-align:center;color:#3730a3;">Step 1 — Show an Up Arrow</h3>
   <div class="callout">
     1️⃣ Go to <strong>Icon</strong> tab → drag <strong>show arrow</strong>.<br>
     2️⃣ Choose <strong>N</strong> (Up).<br>
     3️⃣ Place inside <strong>on start</strong> → Run to see it light up!<br>
     Liam: “GlowBit’s pointing up!”
   </div>`,
  `<h3 style="text-align:center;color:#0e7490;">Step 2 — Map 4 Commands to 4 Arrows</h3>
   <div class="callout">
     • On Start → E  (right)<br>
     • Button A → N (up)<br>
     • Button B → S (down)<br>
     • Shake → W (left)
   </div>`,
  `<div class="callout" style="text-align:center;">
     <button class="gb-btn check" id="open-solution">✅ Check Your Setup</button>
   </div>`
  ];

  /* --- Pagination --- */
  function paginate(){
    const sidebar=document.querySelector('#glowbit-project9 .glowbit-left');
    if(!sidebar)return;
    sidebar.innerHTML=stepCards.join('');
    const frame=document.createElement('div');frame.className='character-frame';
    frame.innerHTML='<img src="images/GlowBit3.png" alt="GlowBit buddy">';sidebar.appendChild(frame);
  }
  paginate();
  window.addEventListener('resize',()=>{paginate();Blockly.svgResize(lesson.workspace);});

  /* --- Compact modal behavior (mirrors Project 8) --- */
  const openBtn=document.getElementById('open-solution');
  const modal=document.getElementById('solutionModalP9');
  const wsDiv=document.getElementById('solutionWorkspaceP9');
  const closeBtns=[document.getElementById('solutionCloseP9'),
                   document.getElementById('solutionCloseBtnP9')];
  openBtn.addEventListener('click',()=>{
    modal.style.display='block';
    const ws=Blockly.inject(wsDiv,{readOnly:true,scrollbars:true});
    Blockly.serialization.workspaces.load(window.solutionJson,ws);
  });
  closeBtns.forEach(b=>b.addEventListener('click',()=>modal.style.display='none'));

  console.log("✅ Project 9 – Tilt Navigator ready with working Check Your Setup modal.");
})();
</script>
</body>
</html>
