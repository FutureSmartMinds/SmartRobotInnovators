<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GlowBit Challenge – The Dancing Duo!</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Blockly + Glowbit core -->
  <script src="lib/blockly_compressed.js"></script>
  <script src="lib/blocks_compressed.js"></script>
  <script src="lib/javascript_compressed.js"></script>
  <script src="lib/msg/en.js"></script>
  <script src="assets/global.js"></script>
  <script src="lib/blockly_xml_patch.js"></script>

  <style>
    .gb-wrapper {max-width:1100px;margin:0 auto;font-family:"Segoe UI",Roboto,Arial,sans-serif;}
    .gb-header {text-align:center;background:#e6f9ff;color:#00A1D6;font-size:24px;font-weight:800;
                padding:8px 10px;border-radius:10px;margin-bottom:10px;box-shadow:0 2px 6px rgba(0,0,0,0.1);}
    .gb-header .highlight {color:#7B2CBF;}
    .gb-intro {text-align:center;font-size:16px;line-height:1.5;margin:0 0 10px;color:#374151;
               background:#e0f2fe;border-radius:6px;padding:10px 12px;box-shadow:0 1px 3px rgba(0,0,0,0.06);}
    #glowbit-quiz .glowbit-playground {max-height:540px;overflow-y:auto!important;border-radius:6px;}
    .didyouknow {margin-top:18px;background:#fef9c3;border:2px solid #facc15;padding:10px 12px;
                 border-radius:12px;color:#713f12;font-size:13px;font-weight:600;position:relative;
                 box-shadow:0 2px 5px rgba(0,0,0,0.06);}
    .didyouknow::before {content:"";position:absolute;top:-10px;left:20px;border-width:0 10px 10px 10px;
                         border-style:solid;border-color:transparent transparent #fef9c3 transparent;}

    /* Modal */
    #solutionModalQuiz {display:none;position:fixed;top:60px;right:20px;width:640px;max-width:42%;
                        background:#fff;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,0.28);
                        z-index:12000;overflow:hidden;user-select:none;}
    #solutionHeaderQuiz {cursor:move;padding:10px 12px;background:#00A1D6;color:#fff;font-weight:700;
                         text-align:left;border-radius:10px 10px 0 0;display:flex;justify-content:space-between;align-items:center;}
    #solutionTitleQuiz {font-size:15px;}
    #solutionCloseQuiz {cursor:pointer;font-size:20px;line-height:1;padding:2px 8px;border-radius:6px;
                        color:#fff;background:transparent;border:none;}
    #solutionWorkspaceQuiz {height:380px;width:100%;border-top:1px solid #eee;background:#fafafa;}
    #solutionFooterQuiz {text-align:center;padding:12px;background:#fff;}
    #solutionFooterQuiz button {background:#00A1D6;color:#fff;border:none;border-radius:8px;
                                padding:8px 18px;cursor:pointer;font-weight:700;}
  </style>
</head>

<body>
  <div class="gb-wrapper">
    <div class="gb-header">
      🎯 <span class="highlight">GlowBit Challenge</span>: The Dancing Duo!
    </div>
    <p class="gb-intro">
      Show what you’ve learned! Make GlowBit flash rows of red and blue lights — one after the other — like a real robot dance!
    </p>
    <div id="glowbit-quiz"></div>
  </div>

  <!-- Solution modal -->
  <div id="solutionModalQuiz" aria-hidden="true" role="dialog">
    <div id="solutionHeaderQuiz">
      <div id="solutionTitleQuiz">✅ Correct Solution — GlowBit Challenge</div>
      <button id="solutionCloseQuiz" title="Close">✕</button>
    </div>
    <div id="solutionWorkspaceQuiz" aria-label="Correct solution workspace"></div>
    <div id="solutionFooterQuiz"><button id="solutionCloseBtnQuiz">Close</button></div>
  </div>

<script>
(function waitForGlow(){
  if (!(window.Glowbit && window.Blockly)) return setTimeout(waitForGlow, 120);

  /* ✅ Correct, validated solution JSON */
  const solutionJson = {
    "blocks": {
      "languageVersion": 0,
      "blocks": [
        {
          "type": "forever",
          "x": 20,
          "y": 20,
          "inputs": {
            "DO": {
              "block": {
                "type": "clear_screen",
                "next": {
                  "block": {
                    "type": "set_pixel", "fields": { "X": 0, "Y": 0, "COLOUR": "#FF0000" },
                    "next": {
                      "block": {
                        "type": "set_pixel", "fields": { "X": 1, "Y": 0, "COLOUR": "#FF0000" },
                        "next": {
                          "block": {
                            "type": "set_pixel", "fields": { "X": 2, "Y": 0, "COLOUR": "#FF0000" },
                            "next": {
                              "block": {
                                "type": "set_pixel", "fields": { "X": 3, "Y": 0, "COLOUR": "#FF0000" },
                                "next": {
                                  "block": {
                                    "type": "set_pixel", "fields": { "X": 4, "Y": 0, "COLOUR": "#FF0000" },
                                    "next": {
                                      "block": {
                                        "type": "set_pixel", "fields": { "X": 5, "Y": 0, "COLOUR": "#FF0000" },
                                        "next": {
                                          "block": {
                                            "type": "set_pixel", "fields": { "X": 6, "Y": 0, "COLOUR": "#FF0000" },
                                            "next": {
                                              "block": {
                                                "type": "set_pixel", "fields": { "X": 7, "Y": 0, "COLOUR": "#FF0000" },
                                                "next": {
                                                  "block": {
                                                    "type": "pause", "fields": { "MS": 500 },
                                                    "next": {
                                                      "block": {
                                                        "type": "clear_screen",
                                                        "next": {
                                                          "block": {
                                                            "type": "set_pixel", "fields": { "X": 0, "Y": 4, "COLOUR": "#0000FF" },
                                                            "next": {
                                                              "block": {
                                                                "type": "set_pixel", "fields": { "X": 1, "Y": 4, "COLOUR": "#0000FF" },
                                                                "next": {
                                                                  "block": {
                                                                    "type": "set_pixel", "fields": { "X": 2, "Y": 4, "COLOUR": "#0000FF" },
                                                                    "next": {
                                                                      "block": {
                                                                        "type": "set_pixel", "fields": { "X": 3, "Y": 4, "COLOUR": "#0000FF" },
                                                                        "next": {
                                                                          "block": {
                                                                            "type": "set_pixel", "fields": { "X": 4, "Y": 4, "COLOUR": "#0000FF" },
                                                                            "next": {
                                                                              "block": {
                                                                                "type": "set_pixel", "fields": { "X": 5, "Y": 4, "COLOUR": "#0000FF" },
                                                                                "next": {
                                                                                  "block": {
                                                                                    "type": "set_pixel", "fields": { "X": 6, "Y": 4, "COLOUR": "#0000FF" },
                                                                                    "next": {
                                                                                      "block": {
                                                                                        "type": "set_pixel", "fields": { "X": 7, "Y": 4, "COLOUR": "#0000FF" },
                                                                                        "next": {
                                                                                          "block": { "type": "pause", "fields": { "MS": 500 } }
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  }
                                                                                }
                                                                              }
                                                                            }
                                                                          }
                                                                        }
                                                                      }
                                                                    }
                                                                  }
                                                                }
                                                              }
                                                            }
                                                          }
                                                        }
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      ]
    }
  };

  /* 🧱 Create lesson UI (empty start) */
  const lesson = Glowbit.createLessonUI('glowbit-quiz', {
    title: '',
    instructions: '',
    pixelSize: 28,
    defaultJson: null
  });
  if (lesson && lesson.workspace) lesson.workspace.clear();
  window._lesson_quiz = lesson;

  /* 🪄 Sidebar */
  function overrideSidebar(){
    const container = document.querySelector('#glowbit-quiz');
    if(!container) return;
    const sidebar = [...container.querySelectorAll('div')].find(el => el.innerText && el.innerText.includes('GlowBit Lesson'));
    if(!sidebar) return;

    sidebar.style.background = '#e6f9ff';
    sidebar.style.borderRadius = '10px';
    sidebar.style.padding = '12px';
    sidebar.style.color = '#00A1D6';
    sidebar.style.fontSize = '14px';
    sidebar.style.fontWeight = '500';
    sidebar.style.boxShadow = '0 0 8px rgba(0,0,0,0.08)';

    sidebar.innerHTML =
      '<h3 style="color:#7B2CBF;font-weight:800;font-size:16px;margin-bottom:10px;text-align:center;">🎯 GlowBit Quiz – The Dancing Duo!</h3>' +
      '<p style="font-size:15px;line-height:1.5;color:#374151;">🧠 Make the top row glow <strong>red</strong>, then the bottom row glow <strong>blue</strong>, with a pause in between.<br><br>' +
      '💡 Use a <strong>Forever</strong> loop if you like, so your GlowBit keeps dancing forever!<br><br>' +
      '▶️ <strong>Click Run Program</strong> to start the show.</p>' +
      '<button id="check-setup-btn-quiz" style="display:block;margin:12px auto 6px;padding:8px 14px;border:none;border-radius:6px;background:#00A1D6;color:#fff;font-weight:700;cursor:pointer;">✅ Check Your Setup</button>' +
      '<div class="didyouknow">💡 <strong>Did you know?</strong> Alternating light patterns are used in real robots for alerts, signals, and expressions!</div>';
  }
  overrideSidebar();
  const int = setInterval(overrideSidebar, 400);
  setTimeout(()=>clearInterval(int), 10000);

  /* 🧩 Modal */
  const modal = document.getElementById('solutionModalQuiz');
  document.addEventListener('click', e => {
    if (e.target.id === 'check-setup-btn-quiz') {
      modal.style.display = 'block';
      modal.setAttribute('aria-hidden', 'false');
      if (!window._solutionWorkspaceQuiz) {
        const wsDiv = document.getElementById('solutionWorkspaceQuiz');
        window._solutionWorkspaceQuiz = Blockly.inject(wsDiv, { readOnly: true, scrollbars: true, toolbox: null });
        Blockly.serialization.workspaces.load(solutionJson, window._solutionWorkspaceQuiz);
      }
    }
    if (e.target.id === 'solutionCloseQuiz' || e.target.id === 'solutionCloseBtnQuiz') {
      modal.style.display = 'none';
      modal.setAttribute('aria-hidden', 'true');
    }
  });

  console.log("✅ GlowBit Quiz initialized.");
})();
</script>
</body>
</html>
