<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GlowBit Quiz 1 ‚Äî Color Dance Challenge</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <script src="lib/blockly_compressed.js"></script>
  <script src="lib/blocks_compressed.js"></script>
  <script src="lib/javascript_compressed.js"></script>
  <script src="lib/msg/en.js"></script>
  <script src="assets/global.js"></script>
  <script src="lib/blockly_xml_patch.js"></script>

  <style>
    body { font-family:"Segoe UI", Roboto, Arial, sans-serif; margin:0; background:#f8fafc; }
    .gb-wrapper { max-width:1100px; margin:0 auto; }
    .gb-header {
      text-align:center; background:#e6f9ff; color:#00A1D6; font-size:22px; font-weight:800;
      padding:6px 10px; border-radius:8px; margin:8px 0;
    }
    .gb-header .highlight { color:#7B2CBF; }
    .gb-intro {
      text-align:center; font-size:15px; line-height:1.5; margin:0 0 10px; color:#374151;
      background:#e0f2fe; border-radius:6px; padding:10px 12px;
    }
    #solutionModalQuiz {
      display:none; position:fixed; top:60px; right:20px; width:640px; max-width:42%;
      background:#fff; border-radius:10px; box-shadow:0 6px 20px rgba(0,0,0,0.28);
      z-index:12000; overflow:hidden; user-select:none;
    }
    #solutionHeaderQuiz {
      padding:10px 12px; background:#00A1D6; color:#fff; font-weight:700;
      display:flex; justify-content:space-between; align-items:center;
    }
    #solutionWorkspaceQuiz { height:360px; width:100%; border-top:1px solid #eee; background:#fafafa; }
    #solutionFooterQuiz { text-align:center; padding:12px; background:#fff; }
    #solutionFooterQuiz button {
      background:#00A1D6; color:#fff; border:none; border-radius:8px;
      padding:8px 18px; cursor:pointer; font-weight:700;
    }
  </style>
</head>

<body>
  <div class="gb-wrapper">
    <div class="gb-header">
      üåü <span class="highlight">GlowBit Quiz 1</span>: Color Dance Challenge
    </div>

    <p class="gb-intro">
      Create two glowing rows ‚Äî one <strong style="color:#FF0000;">red</strong> (#FF0000) at y=0 and one
      <strong style="color:#0000FF;">blue</strong> (#0000FF) at y=4.
      Make them light up one after the other with a short pause!
    </p>

    <div id="glowbit-quiz1"></div>
  </div>

  <div id="solutionModalQuiz" aria-hidden="true">
    <div id="solutionHeaderQuiz">
      <span>‚úÖ Correct Answer ‚Äî Color Dance</span>
      <button id="solutionCloseQuiz">‚úï</button>
    </div>
    <div id="solutionWorkspaceQuiz"></div>
    <div id="solutionFooterQuiz"><button id="solutionCloseBtnQuiz">Close</button></div>
  </div>

  <script>
  (function waitForGlow() {
    if (!(window.Glowbit && window.Blockly)) return setTimeout(waitForGlow, 120);

    console.log("‚úÖ GlowBit Quiz initialized.");

    const emptyJson = { blocks: { languageVersion: 0, blocks: [] } };

    // ‚úÖ Build the "solution" dynamically to guarantee valid syntax
    function makeRow(y, color) {
      let first = null, last = null;
      for (let x = 0; x < 8; x++) {
        const block = { type: "set_pixel", fields: { X: x, Y: y, COLOR: color } };
        if (!first) first = block;
        if (last) last.next = { block };
        last = block;
      }
      return first;
    }

    const redRow = makeRow(0, "#FF0000");
    const blueRow = makeRow(4, "#0000FF");

    const solutionJson = {
      blocks: {
        languageVersion: 0,
        blocks: [
          {
            type: "on_start",
            x: 20,
            y: 20,
            inputs: {
              DO: {
                block: {
                  type: "forever",
                  inputs: {
                    DO: {
                      block: {
                        type: "clear_screen",
                        next: {
                          block: Object.assign({}, redRow, {
                            next: {
                              block: {
                                type: "pause_block",
                                fields: { MS: 500 },
                                next: {
                                  block: {
                                    type: "clear_screen",
                                    next: {
                                      block: Object.assign({}, blueRow, {
                                        next: {
                                          block: {
                                            type: "pause_block",
                                            fields: { MS: 500 }
                                          }
                                        }
                                      })
                                    }
                                  }
                                }
                              }
                            }
                          })
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        ]
      }
    };

    const lesson = Glowbit.createLessonUI('glowbit-quiz1', {
      title: '',
      instructions: '',
      pixelSize: 28,
      defaultJson: emptyJson
    });
    window._lesson_quiz1 = lesson;

    function overrideSidebar() {
      const container = document.querySelector('#glowbit-quiz1');
      if (!container) return;
      const sidebar = Array.from(container.querySelectorAll('*')).find(el => el.innerText && el.innerText.includes('GlowBit Lesson'));
      if (!sidebar) return;
      sidebar.style.background = '#e6f9ff';
      sidebar.style.borderRadius = '10px';
      sidebar.style.padding = '12px';
      sidebar.style.color = '#00A1D6';
      sidebar.style.fontSize = '14px';
      sidebar.style.fontWeight = '500';
      const card='margin:10px 0;padding:10px;border-radius:8px;background:#0284C7;color:#fff;font-weight:600;';
      sidebar.innerHTML =
        '<h3 style="color:#00A1D6;font-weight:800;font-size:16px;margin-bottom:10px;text-align:center;">üåü Quiz Challenge üåü</h3>'+
        '<div style="'+card+'">üî¥ Create red lights at y=0 (x 0‚Üí7)</div>'+
        '<div style="'+card+'">‚è∏ Pause 500 ms, clear screen</div>'+
        '<div style="'+card+'">üîµ Create blue lights at y=4 (x 0‚Üí7)</div>'+
        '<div style="'+card+'">‚ôæ Put inside a forever loop</div>'+
        '<button id="check-setup-btn-quiz" style="display:block;margin:12px auto 6px;padding:8px 14px;border:none;border-radius:6px;background:#00A1D6;color:#fff;font-weight:700;cursor:pointer;">‚úÖ Check Your Setup</button>'+
        '<div class="didyouknow">üí° Robots use light patterns to communicate or show emotions!</div>';
    }
    overrideSidebar();
    const fix = setInterval(overrideSidebar, 400);
    setTimeout(()=>clearInterval(fix), 8000);

    // ‚úÖ Modal logic
    const modal = document.getElementById('solutionModalQuiz');
    document.addEventListener('click', (e) => {
      if (e.target.id === 'check-setup-btn-quiz') {
        modal.style.display = 'block';
        modal.setAttribute('aria-hidden', 'false');
        if (!window._solutionWorkspaceQuiz) {
          const wsDiv = document.getElementById('solutionWorkspaceQuiz');
          window._solutionWorkspaceQuiz = Blockly.inject(wsDiv, { readOnly: true, scrollbars: true, toolbox: null });
          Blockly.serialization.workspaces.load(solutionJson, window._solutionWorkspaceQuiz);
        }
      }
      if (e.target.id === 'solutionCloseQuiz' || e.target.id === 'solutionCloseBtnQuiz') {
        modal.style.display = 'none';
        modal.setAttribute('aria-hidden', 'true');
      }
    });
  })();
  </script>
</body>
</html>
