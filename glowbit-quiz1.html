<!-- QUIZ: Two-Color Row Dance -->
  <style>
    .gb-wrapper { max-width:1100px; margin:0 auto; font-family:"Segoe UI", Roboto, Arial, sans-serif; }
    .gb-header {
      text-align:center; background:#e6f9ff; color:#00A1D6; font-size:22px; font-weight:800;
      padding:6px 10px; border-radius:8px; margin-bottom:8px; box-shadow:0 1px 4px rgba(0,0,0,0.08);
    }
    .gb-header .highlight { color:#7B2CBF; }
    .gb-intro {
      text-align:center; font-size:16px; line-height:1.5; margin:0 0 10px; color:#374151;
      background:#e0f2fe; border-radius:6px; padding:10px 12px; box-shadow:0 1px 3px rgba(0,0,0,0.06);
    }
    #glowbit-quiz .glowbit-playground { max-height:540px; overflow-y:auto !important; border-radius:6px; }
    .didyouknow {
      margin-top:18px; background:#fef9c3; border:2px solid #facc15; padding:10px 12px; border-radius:12px;
      color:#713f12; font-size:13px; font-weight:600; position:relative; box-shadow:0 2px 5px rgba(0,0,0,0.06);
    }
    .didyouknow::before {
      content:""; position:absolute; top:-10px; left:20px; border-width:0 10px 10px 10px; border-style:solid;
      border-color:transparent transparent #fef9c3 transparent;
    }

    /* Solution modal */
    #solutionModalQuiz {
      display:none; position:fixed; top:60px; right:20px; width:640px; max-width:42%;
      background:#fff; border-radius:10px; box-shadow:0 6px 20px rgba(0,0,0,0.28);
      z-index:12000; overflow:hidden; user-select:none;
    }
    #solutionHeaderQuiz {
      cursor:move; padding:10px 12px; background:#00A1D6; color:#fff; font-weight:700;
      text-align:left; border-radius:10px 10px 0 0; display:flex; justify-content:space-between; align-items:center;
    }
    #solutionTitleQuiz { font-size:15px; }
    #solutionCloseQuiz {
      cursor:pointer; font-size:20px; line-height:1; padding:2px 8px; border-radius:6px; color:#fff;
      background:transparent; border:none;
    }
    #solutionWorkspaceQuiz { height:360px; width:100%; border-top:1px solid #eee; background:#fafafa; }
    #solutionFooterQuiz { text-align:center; padding:12px; background:#fff; }
    #solutionFooterQuiz button {
      background:#00A1D6; color:#fff; border:none; border-radius:8px; padding:8px 18px; cursor:pointer; font-weight:700;
    }
    @media (max-width:900px) {
      #solutionModalQuiz { left:10px; right:10px; width:auto; max-width:calc(100% - 20px); top:40px; }
      #solutionWorkspaceQuiz { height:260px; }
    }
  </style>
</head>

<body>
  <div class="gb-wrapper">
    <div class="gb-header">
      üåü <span class="highlight">GlowBit Quiz</span>: Two-Color Row Dance
    </div>

    <p class="gb-intro">
      Challenge time! Create two glowing rows ‚Äî one <strong style="color:#FF0000;">red</strong> and one
      <strong style="color:#0000FF;">blue</strong> ‚Äî that light up one after the other.
    </p>

    <div id="glowbit-quiz"></div>
  </div>

  <!-- Solution modal -->
  <div id="solutionModalQuiz" aria-hidden="true" role="dialog">
    <div id="solutionHeaderQuiz">
      <div id="solutionTitleQuiz">‚úÖ Correct Setup ‚Äî Quiz</div>
      <button id="solutionCloseQuiz" title="Close">‚úï</button>
    </div>
    <div id="solutionWorkspaceQuiz" aria-label="Correct solution workspace"></div>
    <div id="solutionFooterQuiz">
      <button id="solutionCloseBtnQuiz">Close</button>
    </div>
  </div>

  <script>
  (function waitForGlow(){
    if(!(window.Glowbit && window.Blockly)) return setTimeout(waitForGlow,120);

    /* Leave the main workspace EMPTY for kids */
    const lesson = Glowbit.createLessonUI('glowbit-quiz', {
      title:'', instructions:'', pixelSize:28, defaultJson:null
    });
    window._lesson_quiz = lesson;

    /* Correct solution (read-only modal). We don't set color fields in JSON
       because your set_pixel block handles color differently; instructions tell kids to use #FF0000 and #0000FF. */
    const solutionJson = {
      "blocks": {
        "languageVersion": 0,
        "blocks": [
          {
            "type": "forever",
            "x": 20,
            "y": 20,
            "inputs": {
              "DO": {
                "block": {
                  "type": "clear_screen",
                  "next": {
                    "block": {
                      "type": "set_pixel","fields":{"X":0,"Y":0},
                      "next": { "block": { "type": "set_pixel","fields":{"X":1,"Y":0},
                        "next": { "block": { "type": "set_pixel","fields":{"X":2,"Y":0},
                          "next": { "block": { "type": "set_pixel","fields":{"X":3,"Y":0},
                            "next": { "block": { "type": "set_pixel","fields":{"X":4,"Y":0},
                              "next": { "block": { "type": "set_pixel","fields":{"X":5,"Y":0},
                                "next": { "block": { "type": "set_pixel","fields":{"X":6,"Y":0},
                                  "next": { "block": { "type": "set_pixel","fields":{"X":7,"Y":0},
                                    "next": { "block": { "type": "pause_block","fields":{"MS":500},
                                      "next": { "block": { "type": "clear_screen",
                                        "next": { "block": { "type": "set_pixel","fields":{"X":0,"Y":4},
                                          "next": { "block": { "type": "set_pixel","fields":{"X":1,"Y":4},
                                            "next": { "block": { "type": "set_pixel","fields":{"X":2,"Y":4},
                                              "next": { "block": { "type": "set_pixel","fields":{"X":3,"Y":4},
                                                "next": { "block": { "type": "set_pixel","fields":{"X":4,"Y":4},
                                                  "next": { "block": { "type": "set_pixel","fields":{"X":5,"Y":4},
                                                    "next": { "block": { "type": "set_pixel","fields":{"X":6,"Y":4},
                                                      "next": { "block": { "type": "set_pixel","fields":{"X":7,"Y":4},
                                                        "next": { "block": { "type": "pause_block","fields":{"MS":500} }
                                                      } }
                                                    } }
                                                  } }
                                                } }
                                              } }
                                            } }
                                          } }
                                        } }
                                      } }
                                    } }
                                  } }
                                } }
                              } }
                            } }
                          } }
                        } }
                      } }
                    }
                  }
                }
              }
            }
          }
        ]
      }
    };

    /* Sidebar with quiz instructions (includes exact color codes) */
    function overrideSidebar(){
      const container = document.querySelector('#glowbit-quiz');
      if(!container) return;

      let sidebar = container.querySelector('.glowbit-sidebar');
      if(!sidebar){
        sidebar = [...container.querySelectorAll('div')].find(el =>
          el.innerText && (
            el.innerText.includes('GlowBit Lesson') ||
            el.innerText.includes('Follow the steps') ||
            /^Step\s*\d+:/.test(el.innerText.trim())
          )
        );
      }
      if(!sidebar) return;

      sidebar.style.background='#e6f9ff';
      sidebar.style.borderRadius='10px';
      sidebar.style.padding='12px';
      sidebar.style.color='#00A1D6';
      sidebar.style.fontSize='14px';
      sidebar.style.fontWeight='500';
      sidebar.style.boxShadow='0 0 8px rgba(0,0,0,0.08)';

      const stepCard='margin:10px 0;padding:10px;border-radius:8px;background:#0284C7;color:#fff;font-weight:600;';
      sidebar.innerHTML =
        '<h3 style="color:#00A1D6;font-weight:800;font-size:16px;margin-bottom:10px;text-align:center;">üåü GlowBit Quiz üåü</h3>' +
        '<div style="'+stepCard+'">üéØ <strong>Your Challenge:</strong> Make two rows glow one after the other ‚Äî the <strong>top row (y=0)</strong> in <strong style="color:#FF0000;">red</strong> <code>#FF0000</code> and the <strong>middle row (y=4)</strong> in <strong style="color:#0000FF;">blue</strong> <code>#0000FF</code>.</div>' +
        '<div style="'+stepCard+'">üß© Use <strong>Set Pixel (x,y,color)</strong> blocks: for each row set <code>y</code> as above, then duplicate blocks for <code>x = 0 ‚Üí 7</code>. Set the <strong>color</strong> input to the codes shown.</div>' +
        '<div style="'+stepCard+'">üßπ Add <strong>Clear Screen</strong> before each row so the lights reset between colors.</div>' +
        '<div style="'+stepCard+'">‚è∏Ô∏è Add a <strong>Pause</strong> (e.g., 500 ms) after each row so they glow one after the other.</div>' +
        '<div style="'+stepCard+'">üîÅ You can use a <strong>Forever</strong> loop if you want the pattern to keep repeating.</div>' +
        '<div style="'+stepCard+'">‚ñ∂Ô∏è Click <strong>Run Program</strong> to see your result, then use <strong>Check Your Setup</strong> to compare with the solution.</div>' +
        '<button id="check-setup-btn-quiz" style="display:block;margin:12px auto 6px;padding:8px 14px;border:none;border-radius:6px;background:#00A1D6;color:#fff;font-weight:700;cursor:pointer;">‚úÖ Check Your Setup</button>' +
        '<div class="didyouknow">üí° <strong>Did you know?</strong> Color codes like <code>#FF0000</code> are called <em>hex</em> colors ‚Äî they tell computers exactly how much red, green, and blue to mix!</div>';
    }
    overrideSidebar();
    const sid = setInterval(overrideSidebar, 400);
    setTimeout(()=>clearInterval(sid), 10000);

    /* Modal logic (read-only solution) */
    const modal = document.getElementById('solutionModalQuiz');
    const closeX = document.getElementById('solutionCloseQuiz');
    const closeBtn = document.getElementById('solutionCloseBtnQuiz');

    // Simple draggable header
    (function makeDraggable(el){
      const header = document.getElementById('solutionHeaderQuiz');
      if(!header) return;
      let dragging=false, startX=0, startY=0, origLeft=0, origTop=0;
      header.addEventListener('mousedown', (e)=>{
        e.preventDefault();
        dragging=true;
        if(el.style.right && el.style.right!=='auto'){
          el.style.left=el.getBoundingClientRect().left+'px';
          el.style.right='auto';
        }
        origLeft=parseInt(el.style.left||el.getBoundingClientRect().left,10);
        origTop =parseInt(el.style.top ||el.getBoundingClientRect().top ,10);
        startX=e.clientX; startY=e.clientY;
        document.addEventListener('mousemove', onDrag);
        document.addEventListener('mouseup', stopDrag);
      });
      function onDrag(e){
        if(!dragging) return;
        el.style.left=(origLeft+(e.clientX-startX))+'px';
        el.style.top =(origTop +(e.clientY-startY))+'px';
      }
      function stopDrag(){
        dragging=false;
        document.removeEventListener('mousemove', onDrag);
        document.removeEventListener('mouseup', stopDrag);
      }
    })(modal);

    document.addEventListener('click', function(e){
      if(e.target && e.target.id==='check-setup-btn-quiz'){
        modal.style.display='block';
        modal.setAttribute('aria-hidden','false');
        if(!window._solutionWorkspaceQuiz){
          const wsDiv = document.getElementById('solutionWorkspaceQuiz');
          window._solutionWorkspaceQuiz = Blockly.inject(wsDiv, { readOnly:true, scrollbars:true, toolbox:null });
          // Load solution via serialization (no color fields included)
          Blockly.serialization.workspaces.load(solutionJson, window._solutionWorkspaceQuiz);
        }
      }
      if(e.target && (e.target.id==='solutionCloseQuiz' || e.target.id==='solutionCloseBtnQuiz')){
        modal.style.display='none';
        modal.setAttribute('aria-hidden','true');
        const btn = document.getElementById('check-setup-btn-quiz');
        if(btn) btn.focus();
      }
    });

    if(typeof Glowbit.showIcon==='function') Glowbit.showIcon('smile');
    console.log('‚úÖ GlowBit Quiz initialized.');
  })();
  </script>
</body>
</html>
