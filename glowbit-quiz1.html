<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GlowBit Quiz ‚Äì Two-Color Row Dance</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Blockly + Glowbit core -->
  <script src="lib/blockly_compressed.js"></script>
  <script src="lib/blocks_compressed.js"></script>
  <script src="lib/javascript_compressed.js"></script>
  <script src="lib/msg/en.js"></script>
  <script src="assets/global.js"></script>
  <script src="lib/blockly_xml_patch.js"></script>

  <style>
    .gb-wrapper { max-width:1100px; margin:0 auto; font-family:"Segoe UI", Roboto, Arial, sans-serif; }
    .gb-header {
      text-align:center; background:#e6f9ff; color:#00A1D6; font-size:22px; font-weight:800;
      padding:6px 10px; border-radius:8px; margin-bottom:8px; box-shadow:0 1px 4px rgba(0,0,0,0.08);
    }
    .gb-header .highlight { color:#7B2CBF; }
    .gb-intro {
      text-align:center; font-size:16px; line-height:1.5; margin:0 0 10px; color:#374151;
      background:#e0f2fe; border-radius:6px; padding:10px 12px; box-shadow:0 1px 3px rgba(0,0,0,0.06);
    }
    #glowbit-quiz .glowbit-playground { max-height:540px; overflow-y:auto !important; border-radius:6px; }
    .didyouknow {
      margin-top:18px; background:#fef9c3; border:2px solid #facc15; padding:10px 12px; border-radius:12px;
      color:#713f12; font-size:13px; font-weight:600; position:relative; box-shadow:0 2px 5px rgba(0,0,0,0.06);
    }
    .didyouknow::before {
      content:""; position:absolute; top:-10px; left:20px;
      border-width:0 10px 10px 10px; border-style:solid; border-color:transparent transparent #fef9c3 transparent;
    }

    /* Solution modal */
    #solutionModalQuiz {
      display:none; position:fixed; top:60px; right:20px; width:640px; max-width:42%;
      background:#fff; border-radius:10px; box-shadow:0 6px 20px rgba(0,0,0,0.28);
      z-index:12000; overflow:hidden; user-select:none;
    }
    #solutionHeaderQuiz {
      cursor:move; padding:10px 12px; background:#00A1D6; color:#fff; font-weight:700;
      border-radius:10px 10px 0 0; display:flex; justify-content:space-between; align-items:center;
    }
    #solutionTitleQuiz { font-size:15px; }
    #solutionCloseQuiz {
      cursor:pointer; font-size:20px; line-height:1; padding:2px 8px;
      color:#fff; background:transparent; border:none;
    }
    #solutionWorkspaceQuiz { height:360px; width:100%; border-top:1px solid #eee; background:#fafafa; }
    #solutionFooterQuiz { text-align:center; padding:12px; background:#fff; }
    #solutionFooterQuiz button {
      background:#00A1D6; color:#fff; border:none; border-radius:8px;
      padding:8px 18px; cursor:pointer; font-weight:700;
    }
  </style>
</head>

<body>
  <div class="gb-wrapper">
    <div class="gb-header">üåü <span class="highlight">GlowBit Quiz</span>: Two-Color Row Dance</div>
    <p class="gb-intro">
      Challenge time! Create two glowing rows ‚Äî one
      <strong style="color:#FF0000;">red</strong> (#FF0000) at <strong>y=0</strong> and one
      <strong style="color:#0000FF;">blue</strong> (#0000FF) at <strong>y=4</strong>.
      Make them light up one after the other with a short pause!
    </p>
    <div id="glowbit-quiz"></div>
  </div>

  <!-- Solution modal -->
  <div id="solutionModalQuiz" aria-hidden="true" role="dialog">
    <div id="solutionHeaderQuiz">
      <div id="solutionTitleQuiz">‚úÖ Correct Setup ‚Äî Quiz</div>
      <button id="solutionCloseQuiz" title="Close">‚úï</button>
    </div>
    <div id="solutionWorkspaceQuiz" aria-label="Correct solution workspace"></div>
    <div id="solutionFooterQuiz"><button id="solutionCloseBtnQuiz">Close</button></div>
  </div>

  <script>
  (function waitForGlow() {
    if (!(window.Glowbit && window.Blockly)) return setTimeout(waitForGlow, 120);
    console.log("‚úÖ GlowBit Quiz initialized.");

    /* Empty workspace */
    const emptyJson = { "blocks": { "languageVersion": 0, "blocks": [] } };

    /* Correct solution JSON ‚Äî syntax checked */
    const solutionJson = {
      "blocks": {
        "languageVersion": 0,
        "blocks": [{
          "type": "forever",
          "x": 20,
          "y": 20,
          "inputs": {
            "DO": {
              "block": {
                "type": "clear_screen",
                "next": {
                  "block": {
                    "type": "set_pixel", "fields": { "X": 0, "Y": 0, "COLOR": "#FF0000" },
                    "next": {
                      "block": { "type": "set_pixel", "fields": { "X": 1, "Y": 0, "COLOR": "#FF0000" },
                      "next": { "block": { "type": "set_pixel", "fields": { "X": 2, "Y": 0, "COLOR": "#FF0000" },
                      "next": { "block": { "type": "set_pixel", "fields": { "X": 3, "Y": 0, "COLOR": "#FF0000" },
                      "next": { "block": { "type": "set_pixel", "fields": { "X": 4, "Y": 0, "COLOR": "#FF0000" },
                      "next": { "block": { "type": "set_pixel", "fields": { "X": 5, "Y": 0, "COLOR": "#FF0000" },
                      "next": { "block": { "type": "set_pixel", "fields": { "X": 6, "Y": 0, "COLOR": "#FF0000" },
                      "next": { "block": { "type": "set_pixel", "fields": { "X": 7, "Y": 0, "COLOR": "#FF0000" },
                      "next": {
                        "block": {
                          "type": "pause_block", "fields": { "MS": 500 },
                          "next": {
                            "block": {
                              "type": "clear_screen",
                              "next": {
                                "block": {
                                  "type": "set_pixel", "fields": { "X": 0, "Y": 4, "COLOR": "#0000FF" },
                                  "next": {
                                    "block": { "type": "set_pixel", "fields": { "X": 1, "Y": 4, "COLOR": "#0000FF" },
                                    "next": { "block": { "type": "set_pixel", "fields": { "X": 2, "Y": 4, "COLOR": "#0000FF" },
                                    "next": { "block": { "type": "set_pixel", "fields": { "X": 3, "Y": 4, "COLOR": "#0000FF" },
                                    "next": { "block": { "type": "set_pixel", "fields": { "X": 4, "Y": 4, "COLOR": "#0000FF" },
                                    "next": { "block": { "type": "set_pixel", "fields": { "X": 5, "Y": 4, "COLOR": "#0000FF" },
                                    "next": { "block": { "type": "set_pixel", "fields": { "X": 6, "Y": 4, "COLOR": "#0000FF" },
                                    "next": { "block": { "type": "set_pixel", "fields": { "X": 7, "Y": 4, "COLOR": "#0000FF" },
                                    "next": { "block": { "type": "pause_block", "fields": { "MS": 500 } } }
                                    }}}}}}}}}}}}}}
                              }
                            }
                          }
                        }
                      }}}}}}}}}}}}}}
                }
              }
            }
          }
        }
      }
    };

    /* Create the lesson UI */
    const lesson = Glowbit.createLessonUI('glowbit-quiz', {
      title: '',
      instructions: '',
      pixelSize: 28,
      defaultJson: emptyJson
    });
    window._lesson_quiz = lesson;

    /* Sidebar setup */
    function overrideSidebar() {
      const container = document.querySelector('#glowbit-quiz');
      if (!container) return;
      const sidebar = Array.from(container.querySelectorAll('*')).find(el => el.innerText && el.innerText.includes('GlowBit Lesson'));
      if (!sidebar) return;

      const card = 'margin:10px 0;padding:10px;border-radius:8px;background:#0284C7;color:#fff;font-weight:600;';
      sidebar.style.background='#e6f9ff';
      sidebar.style.borderRadius='10px';
      sidebar.style.padding='12px';
      sidebar.style.color='#00A1D6';
      sidebar.style.fontSize='14px';
      sidebar.style.fontWeight='500';
      sidebar.style.boxShadow='0 0 8px rgba(0,0,0,0.08)';
      sidebar.innerHTML =
        '<h3 style="color:#00A1D6;font-weight:800;font-size:16px;margin-bottom:10px;text-align:center;">üåü Your Final Challenge üåü</h3>' +
        '<div style="'+card+'">üß† Create a row of <strong style="color:#FF0000;">red</strong> lights at y=0 (x=0‚Üí7).</div>' +
        '<div style="'+card+'">üí° Add a <strong>pause</strong> block, then clear the screen.</div>' +
        '<div style="'+card+'">üíô Create a row of <strong style="color:#0000FF;">blue</strong> lights at y=4 (x=0‚Üí7).</div>' +
        '<div style="'+card+'">‚è± Add another pause and loop it with a <strong>forever</strong> block.</div>' +
        '<button id="check-setup-btn-quiz" style="display:block;margin:12px auto 6px;padding:8px 14px;border:none;border-radius:6px;background:#00A1D6;color:#fff;font-weight:700;cursor:pointer;">‚úÖ Check Your Setup</button>' +
        '<div class="didyouknow">üí° <strong>Did you know?</strong> Robots use loops like this to create glowing animations that repeat endlessly!</div>';
    }

    overrideSidebar();
    const sidebarFix = setInterval(overrideSidebar, 400);
    setTimeout(()=>clearInterval(sidebarFix), 10000);

    /* Modal logic */
    const modal = document.getElementById('solutionModalQuiz');
    document.addEventListener('click', function(e){
      if(e.target.id==='check-setup-btn-quiz'){
        modal.style.display='block'; modal.setAttribute('aria-hidden','false');
        if(!window._solutionWorkspaceQuiz){
          const wsDiv=document.getElementById('solutionWorkspaceQuiz');
          window._solutionWorkspaceQuiz=Blockly.inject(wsDiv,{readOnly:true,scrollbars:true,toolbox:null});
          Blockly.serialization.workspaces.load(solutionJson, window._solutionWorkspaceQuiz);
        }
      }
      if(e.target.id==='solutionCloseQuiz'||e.target.id==='solutionCloseBtnQuiz'){
        modal.style.display='none'; modal.setAttribute('aria-hidden','true');
      }
    });
  })();
  </script>
</body>
</html>
