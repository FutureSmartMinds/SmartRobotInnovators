<script>
window.addEventListener('load', function () {
  console.log("✅ Step1 script loaded. Waiting for Glowbit...");

  (function waitForGlow() {
    if (window.Glowbit && window.Blockly) {
      console.log("✅ Glowbit & Blockly available.");

      try {
        const testXml = `
          <xml xmlns="https://developers.google.com/blockly/xml">
            <block type="math_number">
              <field name="NUM">42</field>
            </block>
          </xml>
        `;

        const lesson = Glowbit.createLessonUI('glowbit-step1', {
          title: 'Blockly Test',
          instructions: 'This is a Blockly test block.',
          pixelSize: 28,
          defaultXml: testXml
        });

        console.log("✅ Blockly UI created successfully.");
        window._lesson_step1 = lesson;

        // Check if SVG actually exists
        const svg = document.querySelector("svg.blocklySvg");
        if (svg) {
          console.log("✅ Blockly SVG found in DOM.");
        } else {
          console.warn("⚠️ Blockly SVG NOT found in DOM. Rendering may have failed.");
        }

      } catch (e) {
        console.error("❌ Error during Blockly UI creation:", e);
      }
    } else {
      console.log("⌛ Waiting for Glowbit or Blockly...");
      setTimeout(waitForGlow, 150);
    }
  })();
});
</script>
