<script>
/* ===============================================================
   Glowbit Step 1 ‚Äì Show Text
   Adapted for GitHub Pages (ensures DOM + Glowbit ready)
   =============================================================== */

window.addEventListener('load', function() {
  console.log("üî• Step1 script tag detected by browser.");
  console.log("‚úÖ DOMContentLoaded fired.");

  function waitForGlow() {
    // Check for Glowbit and Blockly objects first
    if (window.Glowbit && window.Blockly) {
      console.log("‚úÖ Glowbit & Blockly available.");

      const container = document.getElementById('glowbit-step1');
      if (!container) {
        console.error("‚ùå #glowbit-step1 not found in DOM. Blockly cannot render.");
        return;
      } else {
        console.log("‚úÖ Found #glowbit-step1 container in DOM.");
      }

      // Working JSON block preload from LearnWorlds
      const startBlocks = {
        "blocks": {
          "languageVersion": 0,
          "blocks": [
            {
              "type": "show_text",
              "x": 20,
              "y": 20,
              "fields": { "TEXT": "Smart Robot" }
            }
          ]
        }
      };

      // Create Blockly UI
      const lesson = Glowbit.createLessonUI('glowbit-step1', {
        title: '',
        instructions: '',
        pixelSize: 28,
        defaultJson: startBlocks
      });
      window._lesson_step1 = lesson;
      console.log("‚úÖ Glowbit.createLessonUI executed.");

      // Sidebar override
      function overrideSidebar() {
        const container = document.querySelector('#glowbit-step1');
        if (!container) return;

        const sidebar = Array.from(container.querySelectorAll('*')).find(el =>
          el.innerText && (
            el.innerText.includes("GlowBit Lesson") ||
            el.innerText.includes("Follow the steps on the right")
          )
        );

        if (sidebar) {
          sidebar.style.background = '#e6f9ff';
          sidebar.style.borderRadius = '10px';
          sidebar.style.padding = '12px';
          sidebar.style.color = '#00A1D6';
          sidebar.style.fontSize = '14px';
          sidebar.style.fontWeight = '500';
          sidebar.style.boxShadow = '0 0 8px rgba(0,0,0,0.08)';

          const stepCardStyle = 'margin:10px 0;padding:10px;border-radius:8px;background:#0284C7;color:#ffffff;font-weight:600;';

          sidebar.innerHTML =
            '<h3 style="color:#00A1D6;font-weight:800;font-size:16px;margin-bottom:10px;text-align:center;">üåü Follow These Steps üåü</h3>' +
            '<div style="' + stepCardStyle + '">üß© <strong>Go to the "Basic" tab</strong>. Drag the <strong>Show Text</strong> block into the workspace.</div>' +
            '<div style="' + stepCardStyle + '">‚úçÔ∏è <strong>Click the text field</strong> (it says "Hello!" by default). Type <strong>Smart Robot</strong>.</div>' +
            '<div style="' + stepCardStyle + '">üì¶ <strong>Find the "on start"</strong> block in Basic. Drag your Show Text block inside it.</div>' +
            '<div style="' + stepCardStyle + '">‚ñ∂Ô∏è <strong>Click Run Program</strong>. Watch GlowBit scroll <strong>Smart Robot</strong> across its face!</div>' +
            '<div class="didyouknow">üí° <strong>Did you know?</strong> Robots in real life often use screens or lights to share messages, and now you‚Äôll get to try it too.</div>';
        }
      }

      overrideSidebar();
      const sid = setInterval(overrideSidebar, 500);
      setTimeout(() => clearInterval(sid), 10000);

      if (typeof Glowbit.showIcon === 'function') Glowbit.showIcon('smile');
      console.log("‚úÖ Step 1 fully initialized.");

    } else {
      console.log("‚åõ Waiting for Glowbit or Blockly...");
      setTimeout(waitForGlow, 200);
    }
  }

  // Wait 300ms extra to guarantee DOM elements exist
  setTimeout(waitForGlow, 300);
});
</script>
