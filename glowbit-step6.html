<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GlowBit Step 6 ‚Äì Make Lights Loop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Blockly + Glowbit core -->
  <script src="lib/blockly_compressed.js"></script>
  <script src="lib/blocks_compressed.js"></script>
  <script src="lib/javascript_compressed.js"></script>
  <script src="lib/msg/en.js"></script>
  <script src="assets/global.js"></script>
  <script src="lib/blockly_xml_patch.js"></script>

  <style>
    .gb-wrapper {max-width:1100px;margin:0 auto;font-family:"Segoe UI",Roboto,Arial,sans-serif;}
    .gb-header {
      text-align:center;
      background:#e6f9ff;
      color:#00A1D6;
      font-size:22px;
      font-weight:800;
      padding:6px 10px;
      border:3px solid #7dd3fc;
      border-radius:8px;
      margin-bottom:8px;
      box-shadow:0 1px 4px rgba(0,0,0,0.08);
    }
    .gb-header .highlight { color:#991b1b; }
    .gb-intro {
  text-align:center;
  font-size:18px;
  line-height:1.5;
  margin:0 0 12px;
  color:#1e3a8a;
  background:#e0f2fe;
  border:1px solid #7dd3fc;
  border-radius:10px;
  padding:10px 14px;
  font-weight:600;
}
    #glowbit-step6 .glowbit-playground {max-height:540px;overflow-y:auto!important;border-radius:6px;}
    .didyouknow {margin-top:18px;background:#fef9c3;border:2px solid #facc15;padding:10px 12px;
                 border-radius:12px;color:#713f12;font-size:13px;font-weight:600;position:relative;
                 box-shadow:0 2px 5px rgba(0,0,0,0.06);}
    .didyouknow::before {content:"";position:absolute;top:-10px;left:20px;border-width:0 10px 10px 10px;
                         border-style:solid;border-color:transparent transparent #fef9c3 transparent;}

    /* Solution modal */
    #solutionModal6 {display:none;position:fixed;top:60px;right:20px;width:640px;max-width:42%;
                     background:#fff;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,0.28);
                     z-index:12000;overflow:hidden;user-select:none;}
    #solutionHeader6 {cursor:move;padding:10px 12px;background:#00A1D6;color:#fff;font-weight:700;
                      text-align:left;border-radius:10px 10px 0 0;display:flex;justify-content:space-between;align-items:center;}
    #solutionTitle6 {font-size:15px;}
    #solutionClose6 {cursor:pointer;font-size:20px;line-height:1;padding:2px 8px;border-radius:6px;
                     color:#fff;background:transparent;border:none;}
    #solutionWorkspace6 {height:360px;width:100%;border-top:1px solid #eee;background:#fafafa;}
    #solutionFooter6 {text-align:center;padding:12px;background:#fff;}
    #solutionFooter6 button {background:#00A1D6;color:#fff;border:none;border-radius:8px;
                              padding:8px 18px;cursor:pointer;font-weight:700;}
    @media (max-width:900px){
      #solutionModal6{left:10px;right:10px;width:auto;max-width:calc(100%-20px);top:40px;}
      #solutionWorkspace6{height:260px;}
    }
  </style>
</head>

<body>
  <div class="gb-wrapper">
    <div class="gb-header">
      üåü <span class="highlight">Step 6</span>: Make Lights Loop ‚Äî <span class="highlight">GlowBit</span>‚Äôs Dance!
    </div>

    <p class="gb-intro">
      Let‚Äôs code a loop to keep your GlowBit LEDs flashing in a pattern. It‚Äôs like programming GlowBit to dance ‚Äî powered by AI!
    </p>

    <div id="glowbit-step6"></div>
  </div>

  <!-- Solution modal -->
  <div id="solutionModal6" aria-hidden="true" role="dialog">
    <div id="solutionHeader6">
      <div id="solutionTitle6">‚úÖ Correct Setup ‚Äî Step 6</div>
      <button id="solutionClose6" title="Close">‚úï</button>
    </div>
    <div id="solutionWorkspace6" aria-label="Correct solution workspace"></div>
    <div id="solutionFooter6"><button id="solutionCloseBtn6">Close</button></div>
  </div>

  <script>
  (function waitForGlow(){
    if(!(window.Glowbit && window.Blockly)) return setTimeout(waitForGlow,120);

    /* ‚úÖ XML for Check Your Setup */
    const solutionXml = `<xml xmlns="https://developers.google.com/blockly/xml">
      <block type="forever" x="20" y="20">
        <statement name="DO">
          <block type="clear_screen">
            <next>
              <block type="set_pixel"><field name="X">0</field><field name="Y">2</field>
                <next><block type="set_pixel"><field name="X">1</field><field name="Y">2</field>
                  <next><block type="set_pixel"><field name="X">2</field><field name="Y">2</field>
                    <next><block type="set_pixel"><field name="X">3</field><field name="Y">2</field>
                      <next><block type="set_pixel"><field name="X">4</field><field name="Y">2</field>
                        <next><block type="pause_block"><field name="MS">500</field></block></next>
                      </block></next>
                    </block></next>
                  </block></next>
                </block>
              </next>
            </block>
          </statement>
      </block>
    </xml>`;

    /* üß± Create lesson UI (empty start) */
    const lesson = Glowbit.createLessonUI('glowbit-step6', {
  title:'', instructions:'', pixelSize:28, defaultJson:null
});
    window._lesson_step6 = lesson;
    if(lesson && lesson.workspace) lesson.workspace.clear();

    /* ü™Ñ Sidebar */
    function overrideSidebar(){
      const container=document.querySelector('#glowbit-step6');
      if(!container)return;
      const sidebar=[...container.querySelectorAll('div')].find(el=>{
        if(!el||!el.innerText)return false;
        const t=el.innerText.trim();
        return t.includes('GlowBit Lesson')||t.includes('Follow the steps')||/^Step\s*\d+:/.test(t);
      });
      if(!sidebar)return;

      sidebar.style.background='#e6f9ff';
      sidebar.style.borderRadius='10px';
      sidebar.style.padding='12px';
      sidebar.style.color='#00A1D6';
      sidebar.style.fontSize='14px';
      sidebar.style.fontWeight='500';
      sidebar.style.boxShadow='0 0 8px rgba(0,0,0,0.08)';

      const card='margin:10px 0;padding:10px;border-radius:8px;background:#0284C7;color:#fff;font-weight:600;';
      sidebar.innerHTML=
        '<h3 style="color:#00A1D6;font-weight:800;font-size:16px;margin-bottom:10px;text-align:center;">üåü Follow These Steps üåü</h3>'+
        '<div style="'+card+'">üß© From the <strong>Basic</strong> tab, drag a <strong>forever</strong> loop to the workspace.</div>'+
        '<div style="'+card+'">üßπ Add a <strong>Clear Screen</strong> block inside the loop before the Set Pixel blocks.</div>'+
        '<div style="'+card+'">üí° From the <strong>LED</strong> tab, drag 5 <strong>Set Pixel (x,y)</strong> blocks into the loop. Use row y = 2 and x = 0‚Üí4.</div>'+
        '<div style="'+card+'">‚è∏Ô∏è Add a <strong>Pause</strong> block set to 500 ms after the pixels.</div>'+
        '<div style="'+card+'">‚ñ∂Ô∏è Click <strong>Run Program</strong> ‚Äî GlowBit flashes its row like dancing lights!</div>'+
        '<button id="check-setup-btn6" style="display:block;margin:12px auto 6px;padding:8px 14px;border:none;border-radius:6px;background:#00A1D6;color:#fff;font-weight:700;cursor:pointer;">‚úÖ Check Your Setup</button>'+
        '<div class="didyouknow">üí° <strong>Did you know?</strong> Loops are used in robotics for blinking lights and sensor updates!</div>' + 
        '<div style="text-align:center;margin-top:15px;">' +
    '<img src="images/GlowBit11.png" alt="GlowBit waving hello" style="width:85%;max-width:260px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.25);" />' +
  '</div>';;
    }
    overrideSidebar();
    const sid=setInterval(overrideSidebar,400);
    setTimeout(()=>clearInterval(sid),10000);

    /* üß© Modal */
    const modal=document.getElementById('solutionModal6');
    document.addEventListener('click',e=>{
      if(e.target.id==='check-setup-btn6'){
        modal.style.display='block';
        modal.setAttribute('aria-hidden','false');
        if(!window._solutionWorkspace6){
          const wsDiv=document.getElementById('solutionWorkspace6');
          window._solutionWorkspace6=Blockly.inject(wsDiv,{readOnly:true,scrollbars:true,toolbox:null});
          const dom=Blockly.Xml.textToDom(solutionXml);
          Blockly.Xml.domToWorkspace(dom,window._solutionWorkspace6);
        }
      }
      if(e.target.id==='solutionClose6'||e.target.id==='solutionCloseBtn6'){
        modal.style.display='none';
        modal.setAttribute('aria-hidden','true');
      }
    });

    if(typeof Glowbit.showIcon==='function') Glowbit.showIcon('smile');
    console.log('‚úÖ Step 6 initialized.');
  })();
  </script>
</body>
</html>
